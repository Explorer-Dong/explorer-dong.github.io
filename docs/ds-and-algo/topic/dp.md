---
title: åŠ¨æ€è§„åˆ’
---

åŠ¨æ€è§„åˆ’ (Dynamic Programming, DP) ç®—æ³•æ˜¯ä¸€ç§åˆ©ç”¨å­é—®é¢˜çš„è§£æ¥æ±‚è§£åŸé—®é¢˜çš„è§£çš„ç­–ç•¥ã€‚é€šè¿‡å®æ—¶å­˜å‚¨å­é—®é¢˜çš„è§£ï¼Œè¯¥ç®—æ³•åœ¨åŸé—®é¢˜æœ‰å¤§é‡ã€Œé‡å å­é—®é¢˜ã€çš„æƒ…å†µä¸‹å°¤ä¸ºæœ‰æ•ˆã€‚

å½“ç„¶ï¼ŒåŠ¨æ€è§„åˆ’ç®—æ³•å¥æ•ˆçš„å‰ææ˜¯åŸé—®é¢˜å…·æœ‰ã€Œæœ€ä¼˜å­ç»“æ„ã€çš„æ€§è´¨ï¼Œå³åŸé—®é¢˜å¯ä»¥è¢«åˆ†è§£ä¸ºå¤šä¸ªå­é—®é¢˜æ¥æ±‚è§£ï¼›åŒæ—¶ï¼ŒåŠ¨æ€è§„åˆ’ç®—æ³•è¿˜éœ€è¦éµå®ˆã€Œæ— åæ•ˆæ€§ã€åŸåˆ™ï¼Œå³å½“å‰é—®é¢˜ä¾èµ–çš„å­é—®é¢˜åªèƒ½æ˜¯å·²ç»è¢«è§£å†³çš„é—®é¢˜ï¼Œè€Œä¸èƒ½æ˜¯åœ¨æœªæ¥æ‰ä¼šè¢«è§£å†³çš„é—®é¢˜ã€‚æ¨èé˜…è¯»ã€ŠåŠ¨æ€è§„åˆ’æ‚è°ˆã€‹ [^talk] æ¥å¯¹åŠ¨æ€è§„åˆ’æœ‰ä¸€ä¸ªæ›´æ·±åˆ»çš„è®¤çŸ¥ã€‚

[^talk]: [åŠ¨æ€è§„åˆ’æ‚è°ˆ | ä½•é€Š - (leetcode.cn)](https://leetcode.cn/discuss/post/223998/dong-tai-gui-hua-za-tan-by-heltion/)

ä»ä¸Šé¢çš„æ–‡å­—å¯ä»¥çœ‹å‡ºï¼ŒåŠ¨æ€è§„åˆ’ç®—æ³•æ˜¯åŸºäºå­é—®é¢˜å¾—åˆ°åŸé—®é¢˜çš„è§£ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸€èˆ¬è¢«ç§°ä¸ºçŠ¶æ€è½¬ç§»ã€‚å¸¸è§çš„æœ‰ã€Œè¢«åŠ¨è½¬ç§»ã€ä¸ã€Œä¸»åŠ¨è½¬ç§»ã€ä¸¤ç§ç­–ç•¥ï¼Œä½†è¿™ä»…ä»…æ˜¯æ€è€ƒä¹ æƒ¯çš„åŒºåˆ«ï¼Œæœ¬æ–‡å°†ä¼šå…¨éƒ¨ä½¿ç”¨å‰è€…ã€‚ä¸‹å›¾å±•ç¤ºäº†ä¸¤ç§è½¬ç§»ç­–ç•¥çš„é€»è¾‘ï¼š

![è¢«åŠ¨è½¬ç§» vs. ä¸»åŠ¨è½¬ç§»](https://cdn.dwj601.cn/images/202408291538900.png)

/// caption
è¢«åŠ¨è½¬ç§» vs. ä¸»åŠ¨è½¬ç§»
///

åŠ¨æ€è§„åˆ’ç®—æ³•çš„æ ¸å¿ƒæœ‰ä¸¤ç‚¹ï¼š

1. çŠ¶æ€å®šä¹‰ã€‚å¦‚ä½•åˆç†å®šä¹‰åšåˆ°ã€Œå®Œæ•´è¡¨ç¤ºã€æ‰€æœ‰çŠ¶æ€ï¼Ÿ
2. çŠ¶æ€è½¬ç§»ã€‚å¦‚ä½•åˆç†åˆ’åˆ†åšåˆ°ã€Œä¸é‡ä¸æ¼ã€æ›´æ–°ç»“æœï¼Ÿ

æœ¬æ–‡å°†ä¼šå›´ç»•ä¸Šé¢ä¸¤ä¸ªæ ¸å¿ƒè¦ç‚¹ï¼Œä»‹ç»åŠ¨æ€è§„åˆ’ç®—æ³•åœ¨å„ç±»é—®é¢˜ä¸‹çš„ç»å…¸æ¨¡å‹ã€‚è¯»è€…åº”å½“æ—¶åˆ»ç‰¢è®°ä¸Šè¿°ä¸¤ä¸ªæ ¸å¿ƒè¦ç‚¹ï¼Œé€æ­¥æ„å»ºè‡ªå·±çš„åŠ¨æ€è§„åˆ’ç†è®ºä½“ç³»ã€‚

## å¼•å…¥

ä¸Šæ¥å°±ä»‹ç»å„ç§ DP æ¨¡å‹ä¼¼ä¹å¯¹æ–°æ‰‹å¹¶ä¸å‹å¥½ï¼Œè¿™é‡Œå…ˆç®€å•è¿‡æ¸¡ä¸€ä¸‹ã€‚åœ¨å¼€å§‹å­¦ä¹  DP ä¹‹å‰ï¼Œä½ ä¸€å®šåšè¿‡ç±»ä¼¼äºæ±‚æ–æ³¢é‚£å¥‘æ•°åˆ—çš„é—®é¢˜ï¼Œå³æœ‰ä¸€ä¸ªå‡½æ•°å®šä¹‰ä¸ºï¼š

$$
\begin{cases}
f_i = 1, &i = 1\\
f_i = 1, &i = 2\\
f_i = f_{i-1}+f_{i-2}, &i\ge3
\end{cases}
$$

ä½ ä¸€å®šå¯ä»¥è½»æ¾åœ°å†™å‡ºä¸‹é¢çš„æœç´¢ï¼ˆé€’å½’ï¼‰å‡½æ•°ï¼š

```c++
int f(int i) {
    if (i == 1 || i == 2) {
        return 1;
    }
    return f(i - 1) + f(i - 2);
}
```

ä½†æ˜¯å½“ $n$ è¶…è¿‡ $30$ ä»¥åï¼Œä¸Šé¢çš„ç¨‹åºå°±å¾ˆéš¾åœ¨ä½ å¯å¿å—çš„æ—¶é—´å†…è®¡ç®—å‡ºç»“æœäº†ã€‚æ­¤æ—¶å°±éœ€è¦æ›´é«˜æ•ˆçš„ç®—æ³•æ¥æ±‚è§£è¿™ä¸ªé—®é¢˜ã€‚

ä½ ä¸€å®šå¯ä»¥å¾ˆè½»æ¾åœ°çœ‹æ‡‚ä¸‹é¢çš„ç¨‹åºï¼š

```c++
int f(int n) {
    int f[n + 1] {};
    f[1] = f[2] = 1;
    for (int i = 3; i <= n; i++) {
        f[i] = f[i - 1] + f[i - 2];
    }
    return f[n];
}
```

å¤§å®¶ä¹ æƒ¯äºå°†å…¶ç§°ä½œ **é€’æ¨**ï¼Œå› ä¸ºæ¯ä¸€ä¸ªç»“æœéƒ½æ˜¯åŸºäºç›¸é‚»çš„å­ç»“æœæ¨å¯¼è€Œæ¥ï¼Œä½†è¿™å…¶å®å°±æ˜¯åŠ¨æ€è§„åˆ’ç®—æ³•ã€‚åœ¨åé¢çš„å†…å®¹ä¸­ï¼Œä½ å°†ä¼šçœ‹åˆ°æ›´å¤šè¿™ç§åŸºäºç›¸é‚»å­é—®é¢˜çš„ç»“æœæ¨å¯¼å‡ºåŸé—®é¢˜ç»“æœçš„ä¾‹å­ã€‚

ä½ ä¹Ÿä¸€å®šå¯ä»¥å¾ˆè½»æ¾åœ°çœ‹æ‡‚ä¸‹é¢çš„ç¨‹åºï¼š

```c++
bool vis[10];
int ans[10];

int f(int n) {
    if (n == 1 || n == 2) {
        return 1;
    }
    if (vis[n]) {
        return ans[n];
    }
    vis[n] = true;
    return ans[n] = f(n - 1) + f(n - 2);
}
```

å¤§å®¶ä¹ æƒ¯äºå°†å…¶ç§°ä½œ **è®°å¿†åŒ–æœç´¢**ï¼Œå› ä¸ºå…¶æœ¬è´¨ä¸Šè¿˜æ˜¯æœç´¢ï¼Œåªä¸è¿‡å°†ä¸­é—´çš„è®¡ç®—ç»“æœåˆ©ç”¨ `ans` æ•°ç»„ä¿å­˜èµ·æ¥äº†è€Œå·²ã€‚å½“ç„¶ï¼ŒæŠŠè®°å¿†åŒ–æœç´¢å†™åœ¨è¿™é‡Œå¹¶ä¸ä»£è¡¨å…¶ä»…å±€é™äºæ­¤ï¼Œæœ‰äº›æ—¶å€™è®°å¿†åŒ–æœç´¢ç”šè‡³å¯ä»¥è§£å†³é«˜éš¾åº¦çš„é¢˜ç›®ï¼Œæˆ–è€…æœ‰åŠ©äºä½ æ€è€ƒå‡ºé€’æ¨ï¼ˆåŠ¨æ€è§„åˆ’ï¼‰å†™æ³•ã€‚

### ä¾‹ä¸€



| æ ‡ç­¾ ğŸ· |  éš¾åº¦ ğŸ”¥   |                         é“¾æ¥ ğŸ”—                         | ç­–ç•¥ â­ |
| :----: | :-------: | :----------------------------------------------------: | :----- |
|  é€’æ¨  | CF 1200 * | [AcWing](https://www.acwing.com/problem/content/5574/) | /      |

é¢˜æ„ï¼šç»™å®š $n\ (2\le n\le 10^5)$ ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸€ä¸ªå­—ç¬¦ä¸²åè½¬éƒ½æœ‰ä¸€ä¸ªä»£ä»· $c\ (0 \le c_i \le 10^9)$ï¼Œç°åœ¨éœ€è¦å¯¹è¿™ $n$ ä¸ªå­—ç¬¦ä¸²è¿›è¡Œå¯èƒ½çš„ç¿»è½¬æ“ä½œä½¿å¾—æœ€ç»ˆçš„ $n$ ä¸ªå­—ç¬¦ä¸²å‘ˆç°å­—å…¸åºä¸é™çš„çŠ¶æ€ï¼Œç»™å‡ºæœ€å°ç¿»è½¬ä»£ä»·ã€‚å¦‚æœæ— æ³•è¾¾æˆåˆ™è¾“å‡º $-1$ã€‚

æ€è·¯ï¼šå¾ˆæ˜¾ç„¶æ¯ä¸€ä¸ªå­—ç¬¦ä¸²éƒ½æœ‰ä¸¤ç§çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡ŒäºŒå‰æœç´¢æˆ–è€…äºŒè¿›åˆ¶æšä¸¾ï¼Œåˆç”±äºæ¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„çŠ¶æ€åªä¾èµ–äºå‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ç¬¦åˆ DP çš„æ¡ä»¶å®šä¹‰ï¼Œå¯ä»¥è¿›è¡Œ DPï¼š

- çŠ¶æ€å®šä¹‰ï¼š$f_{i0}$ è¡¨ç¤ºç¬¬ $i$ ä¸ªå­—ç¬¦ä¸²ä¸ç¿»è½¬çš„æƒ…å†µä¸‹ï¼Œè®© $s_{0\sim i}$ å­—å…¸åºä¸é™æœ€å°ä»£ä»·ï¼Œé‚£ä¹ˆ $f_{i1}$ è¡¨ç¤ºç¬¬ $i$ ä¸ªå­—ç¬¦ä¸²ç¿»è½¬çš„æƒ…å†µä¸‹ï¼Œè®© $s_{0\sim i}$ å­—å…¸åºä¸é™æœ€å°ä»£ä»·ï¼›
- çŠ¶æ€è½¬ç§»ï¼šå½“å‰çŠ¶æ€ä»…ä»…ä»å‰ä¸€ä¸ªçŠ¶æ€è½¬ç§»è€Œæ¥ï¼Œæšä¸¾å½“å‰å­—ç¬¦ä¸²ç¿»ä¸ä¸ç¿»ã€å‰ä¸€ä¸ªå­—ç¬¦ä¸²ç¿»ä¸ä¸ç¿»å…± 4 ç§çŠ¶æ€å³å¯ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$

=== "Python"

    ```python
    n = int(input().strip())
    c = list(map(int, input().strip().split()))
    s = [input().strip() for _ in range(n)]
    
    inf = 10**15
    f = [[inf] * 2 for _ in range(n)]
    f[0][0], f[0][1] = 0, c[0]
    for i in range(1, n):
        if s[i] >= s[i - 1]:
            f[i][0] = min(f[i][0], f[i - 1][0])
        if s[i] >= s[i - 1][::-1]:
            f[i][0] = min(f[i][0], f[i - 1][1])
        if s[i][::-1] >= s[i - 1]:
            f[i][1] = min(f[i][1], f[i - 1][0] + c[i])
        if s[i][::-1] >= s[i - 1][::-1]:
            f[i][1] = min(f[i][1], f[i - 1][1] + c[i])
    
    print(-1 if min(f[-1]) == inf else min(f[-1]))
    ```

=== "C++"

    ```c++
    #include <iostream>
    #include <vector>
    #include <climits>
    
    using namespace std;
    using ll = long long;
    const ll inf = LLONG_MAX / 3;
    
    int main() {
        int n;
        cin >> n;
        
        vector<ll> c(n);
        for (int i = 0; i < n; i++) {
            cin >> c[i];
        }
    
        vector<string> s(n);
        for (int i = 0; i < n; i++) {
            cin >> s[i];
        }
    
        vector<vector<ll>> f(n, vector<ll>(2, inf));
        f[0][0] = 0, f[0][1] = c[0];
        for (int i = 1; i < n; i++) {
            string rpre = string(s[i - 1].rbegin(), s[i - 1].rend());
            string rnow = string(s[i].rbegin(), s[i].rend());
    
            if (s[i] >= s[i - 1]) {
                f[i][0] = min(f[i][0], f[i - 1][0]);
            }
            if (s[i] >= rpre) {
                f[i][0] = min(f[i][0], f[i - 1][1]);
            }
            if (rnow >= s[i - 1]) {
                f[i][1] = min(f[i][1], f[i - 1][0] + c[i]);
            }
            if (rnow >= rpre) {
                f[i][1] = min(f[i][1], f[i - 1][1] + c[i]);
            }
        }
    
        if (f[n - 1][0] == inf && f[n - 1][1] == inf) {
            cout << "-1\n";
        } else {
            cout << min(f[n - 1][0], f[n - 1][1]) << "\n";
        }
    
        return 0;
    }
    ```

åŒç±»é¢˜æ¨èï¼š

- [CF 1300 * | æœ€å¤§åŒ–å­æ•°ç»„çš„æ€»æˆæœ¬ | LeetCode - (leetcode.cn)](https://leetcode.cn/problems/maximize-total-cost-of-alternating-subarrays/)
- [CF 1400 * | è´¹è§£çš„å¼€å…³ | AcWing - (www.acwing.com)](https://www.acwing.com/problem/content/97/)

## é€’æ¨

Squaring

<https://codeforces.com/contest/1995/problem/C>

> æ ‡ç­¾ï¼šé€’æ¨ã€æ•°å­¦
>
> é¢˜æ„ï¼šç»™å®šä¸€ä¸ªåºåˆ—ï¼Œå¯ä»¥å¯¹å…¶ä¸­ä»»ä½•ä¸€ä¸ªæ•°è¿›è¡Œä»»æ„æ¬¡å¹³æ–¹æ“ä½œï¼Œå³ $a_i \to a_i^2$ï¼Œé—®æœ€å°‘éœ€è¦æ‰§è¡Œå¤šå°‘æ¬¡æ“ä½œå¯ä»¥ä½¿å¾—åºåˆ—ä¸å‡ã€‚
>
> æ€è·¯ï¼š
>
> - é¦–å…ˆæ˜¾ç„¶çš„æˆ‘ä»¬ä¸å¸Œæœ›ç¬¬ä¸€ä¸ªæ•° $a_0$ å˜å¤§ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥ä»ç¬¬äºŒä¸ªæ•°å¼€å§‹å’Œå‰ä¸€ä¸ªæ•°è¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œè¿›è¡Œå¯èƒ½çš„å¹³æ–¹æ“ä½œå¹¶è®¡æ•°ã€‚ä½†æ˜¯ç”±äºæ•°å­—å¯èƒ½ä¼šå¾ˆå¤§ï¼Œä½¿ç”¨é«˜ç²¾åº¦æ˜¾ç„¶ä¼šè¶…æ—¶ï¼Œè€Œè¿™äº›æ•°å­—æœ¬èº«çš„æ„ä¹‰æ˜¯ç”¨æ¥å’Œå‰ä¸€ä¸ªæ•°è¿›è¡Œå¤§å°æ¯”è¾ƒçš„ï¼Œå¹¶ä¸”å˜åŒ–çš„å½¢å¼ä¹Ÿä»…ä»…æ˜¯å¹³æ–¹æ“ä½œã€‚æˆ‘ä»¬ä¸å¦¨ç»´æŠ¤å…¶æŒ‡æ•°ï¼Œè¿™æ ·æ—¢å¯ä»¥è¿›è¡Œå¤§å°æ¯”è¾ƒï¼Œä¹Ÿä¸ç”¨å­˜å‚¨æ•°å­—æœ¬èº«è€Œé€ æˆæº¢å‡ºã€‚å½“ç„¶å˜ä¸ºä½¿ç”¨æŒ‡æ•°å­˜å‚¨ä»¥åå¦‚ä½•è¿›è¡Œå¤§å°æ¯”è¾ƒä»¥åŠå¦‚ä½•ç»´æŠ¤æŒ‡æ•°åºåˆ—æœ‰æ‰€ä¸åŒï¼Œæˆ‘ä»¬å…ˆä»ä¸€èˆ¬çš„è§’åº¦å‡ºå‘ï¼Œè¿›è€Œä»è¡¨è¾¾å¼æœ¬èº«çš„æ•°å­¦è§’åº¦è®¨è®ºç‰¹æ®Šæƒ…å†µçš„å¤„ç†ã€‚
>
> - å¯¹äºå½“å‰æ•°å­— $a_i$ å’Œå‰ä¸€ä¸ªæ•°å­— $a_{i-1}$ åŠå…¶æŒ‡æ•° $z_{i-1}$ï¼Œå¦‚æœæƒ³è¦å½“å‰æ•°å­—ç»è¿‡å¯èƒ½çš„ k æ¬¡å¹³æ–¹æ“ä½œåä¸å°äºå‰ä¸€ä¸ªæ•°ï¼Œå³ $\displaystyle a_{i-1}^{2^{z_{i-1}}}\le a_i^{2^{k}}$ï¼Œåˆ™æ˜“å¾—ä¸‹é¢çš„è¡¨è¾¾å¼ï¼š
>
>     $$
>     k:= z_{i-1}+ \left\lceil \log_2(\frac{\log_2 {a_{i-1}}}{\log_2{a_i}}) \right \rceil
>     $$
>
>     ç”±äº $a_j \in [1, 10^6],z_j\ge 0,k \ge 0$ï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¿…è¦ï¼š
>
>     1. è®¨è®º $a_i$ å’Œ $a_{i-1}$ å’Œ $1$ çš„å¤§å°å…³ç³»ã€‚å› ä¸ºå®ƒä»¬çš„å¯¹æ•°è®¡ç®—ç»“æœåœ¨çœŸæ•°éƒ¨åˆ†ã€‚
>     2. è®¨è®º $k$ å’Œ $0$ çš„å¤§å°å…³ç³»ã€‚å› ä¸ºä¸€æ—¦ $a_{i-1} < a_i$ï¼Œåˆ™æœ‰å¯èƒ½å‡ºç°è®¡ç®—ç»“æœä¸ºè´Ÿçš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µè¡¨æ˜éœ€è¦å¯¹å½“å‰æ•° $a_i$ è¿›è¡Œå¼€æ ¹çš„æ“ä½œã€‚åˆç”±äº $a_i\ge1$ï¼Œå› æ­¤å¼€æ ¹æ“ä½œå°±è¡¨æ˜å‡å°å½“å‰çš„æ•°ï¼Œä¹Ÿå°±è¡¨æ˜å½“å‰æ•°åœ¨ä¸è¿›è¡Œå¹³æ–¹æ“ä½œçš„æƒ…å†µä¸‹å°±å·²ç»æ»¡è¶³ä¸å‡çš„æ¡ä»¶äº†ï¼Œä¹Ÿå°±ä¸éœ€è¦æ“ä½œäº†ã€‚æ­¤æ—¶å¯¹åº”çš„æŒ‡æ•° $z_i$ å°±æ˜¯ $0$ï¼Œå¯¹äºç­”æ¡ˆçš„è´¡çŒ®ä¹Ÿæ˜¯ $0$ã€‚
>
> æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$

```cpp
#include <bits/stdc++.h>

using ll = long long;
using namespace std;

void solve() {
    int n;
    cin >> n;
    
    vector<int> a(n);
    for (int i = 0; i < n; i++) {
        cin >> a[i];
    }
    
    vector<ll> z(n, 0);
    ll res = 0;
    for (int i = 1; i < n; i++) {
        if (a[i] == 1 && a[i - 1] > 1) {
            cout << -1 << "\n";
            return;
        } else if (a[i] == 1 && a[i - 1] == 1 || a[i - 1] == 1) {
            continue;
        }
        ll t = z[i - 1] + ceil(log2(log2(a[i - 1]) / log2(a[i])));
        z[i] = max(0ll, t);
        res += z[i];
    }
    
    cout << res << "\n";
}

signed main() {
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr);
    int T = 1;
    std::cin >> T;
    while (T--) solve();
    return 0;
}
```

```python
from typing import List, Tuple
from collections import defaultdict, deque
from itertools import combinations, permutations
import math, heapq, queue

II = lambda: int(input())
FI = lambda: float(input())
MII = lambda: tuple(map(int, input().split()))
LII = lambda: list(map(int, input().split()))


def solve() -> None:
    n = II()
    a = LII()
    
    z = [0] * n
    for i in range(1, n):
        if a[i] == 1 and a[i - 1] > 1:
            print(-1)
            return
        elif a[i] == 1 and a[i - 1] == 1 or a[i - 1] == 1:
            continue
        t = z[i - 1] + math.ceil(math.log2(math.log2(a[i - 1]) / math.log2(a[i])))
        z[i] = max(0, t)
        
    print(sum(z))


if __name__ == '__main__':
    T = 1
    T = II()
    while T: solve(); T -= 1
```

ç‰›çš„è¯­è¨€å­¦

<https://www.acwing.com/problem/content/description/5559/>

> æ ‡ç­¾ï¼šé€’æ¨ã€dfs
>
> é¢˜æ„ï¼šå·²çŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²ç”±å‰æ®µçš„ä¸€ä¸ªè¯æ ¹å’Œåæ®µçš„å¤šä¸ªè¯ç¼€ç»„æˆã€‚è¯æ ¹çš„è¦æ±‚æ˜¯é•¿åº¦è‡³å°‘ä¸º 5ï¼Œè¯ç¼€çš„è¦æ±‚æ˜¯é•¿åº¦è¦ä¹ˆæ˜¯ 2, è¦ä¹ˆæ˜¯ 3ï¼Œä»¥åŠä¸å…è®¸è¿ç»­çš„ç›¸åŒè¯ç¼€ç»„æˆåæ®µã€‚ç°åœ¨ç»™å®šæœ€ç»ˆçš„å­—ç¬¦ä¸²ï¼Œé—®ä¸€å…±æœ‰å¤šå°‘ç§è¯ç¼€ï¼ŸæŒ‰ç…§å­—å…¸åºè¾“å‡ºæ‰€æœ‰å¯èƒ½çš„è¯ç¼€
>
> - æ€è·¯ä¸€ï¼š**æœç´¢**ã€‚å¾ˆæ˜¾ç„¶æˆ‘ä»¬åº”è¯¥ä»å­—ç¬¦ä¸²çš„æœ€åå¼€å§‹æšä¸¾è¯ç¼€è¿›è¡Œæœç´¢ï¼Œå› ä¸ºè¯ç¼€å‰é¢çš„æ‰€æœ‰å­—ç¬¦å…¨éƒ¨éƒ½å¯ä»¥ä½œä¸ºè¯æ ¹åˆæ³•å­˜åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘å½“å‰åˆ’åˆ†å‡ºæ¥çš„è¯ç¼€æ˜¯å¦åˆæ³•å³å¯ã€‚çº¦æŸåªæœ‰ä¸€ä¸ªï¼Œä¸èƒ½ä¸åé¢åˆ’åˆ†å‡ºæ¥çš„è¯ç¼€ç›¸åŒå³å¯ï¼Œç”±äºæˆ‘ä»¬æ˜¯ä»åå¾€å‰æœç´¢ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æœç´¢æ—¶ä¿ç•™åä¸€ä¸ªè¯ç¼€å³å¯ã€‚å¦‚æœå½“å‰è¯ç¼€å’Œä¸Šä¸€ä¸ªè¯ç¼€ç›¸åŒåˆ™è¿”å›ï¼Œåä¹‹å¦‚æœåˆæ³•åˆ™åŠ å…¥ set è‡ªåŠ¨è¿›è¡Œå­—å…¸åºæ’åºã€‚
>
>     æ—¶é—´å¤æ‚åº¦ï¼š$O(2^{\frac{n}{2}})$
>
> - æ€è·¯äºŒï¼š**åŠ¨æ€è§„åˆ’ï¼ˆé€’æ¨ï¼‰**ã€‚åŠ¨è§„å…¶å®å°±æ˜¯ **dfs çš„é€†è¿‡ç¨‹**ï¼Œæˆ‘ä»¬ä»å·²çŸ¥ç»“æœåˆ¤æ–­å½“å‰å±€é¢æ˜¯å¦åˆæ³•ã€‚å¾ˆæ˜¾ç„¶è¯æ ¹æ˜¯åŒ…ç½—ä¸‡è±¡çš„ï¼Œåªè¦é•¿åº¦åˆæ³•ï¼Œä¸ç®¡ä»€ä¹ˆæ ·çš„éƒ½æ˜¯å¯è¡Œçš„ï¼Œæ•…æˆ‘ä»¬åœ¨åˆ¤æ–­å½“å‰å±€é¢æ˜¯å¦åˆæ³•æ—¶ï¼Œåªéœ€è¦åˆ¤æ–­å½“å‰è¯ç¼€æ˜¯å¦åˆæ³•å³å¯ã€‚äºæ˜¯ä¾¿å¯çŸ¥å½“å‰çŠ¶æ€æ˜¯ä»åé¢çš„å­—ç¬¦ä¸²è½¬ç§»è¿‡æ¥çš„ã€‚æˆ‘ä»¬å®šä¹‰çŠ¶æ€è½¬ç§»è®°å¿†æ•°ç»„ `f[i]` è¡¨ç¤ºå­—ç¬¦ä¸² `s[1,i]` æ˜¯å¦å¯ä»¥ç»„æˆè¯æ ¹ã€‚å¦‚æœ `f[i]` ä¸ºçœŸï¼Œåˆ™è¡¨ç¤º `s[1,i]` ä¸ºä¸€ä¸ªåˆæ³•çš„è¯æ ¹ï¼Œ`s[i+1,n]` ä¸ºä¸€ä¸ªåˆæ³•çš„è¯ç¼€ä¸²ï¼Œé‚£ä¹ˆè¯æ ¹åé¢ç´§è·Ÿç€çš„ä¸€å®šæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º 2 æˆ– 3 çš„åˆæ³•è¯ç¼€ã€‚
>
>     - æˆ‘ä»¬ä»¥ç´§è·Ÿç€é•¿åº¦ä¸º 2 çš„åˆæ³•è¯ç¼€ä¸ºä¾‹ã€‚å¦‚æœ `s[i+1,i+2]` ä¸ºä¸€ä¸ªåˆæ³•çš„è¯ç¼€ï¼Œåˆ™å¿…é¡»è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€
>         1. `s[i+1,i+2]` ä¸ `s[i+3,i+4]` ä¸ç›¸ç­‰ï¼Œå³åé¢çš„åé¢æ˜¯ä¸€ä¸ªé•¿åº¦ä¹Ÿä¸º **2** ä¸”åˆæ³•çš„è¯ç¼€
>         2. `s[1,i+5]` æ˜¯ä¸€ä¸ªåˆæ³•çš„è¯æ ¹ï¼Œå³ `f[i+5]` æ ‡è®°ä¸ºçœŸï¼Œå³åé¢çš„åé¢æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º **3** ä¸”åˆæ³•çš„è¯ç¼€
>
>     - ä»¥ç´§è·Ÿç€é•¿åº¦ä¸º 3 çš„å“ˆæ³•è¯ç¼€åŒç†ã€‚å¦‚æœ `s[i+1,i+3]` ä¸ºä¸€ä¸ªåˆæ³•çš„è¯ç¼€ï¼Œåˆ™å¿…é¡»è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€
>         1. `s[i+1,i+3]` ä¸ `s[i+4,i+6]` ä¸ç›¸ç­‰ï¼Œå³åé¢çš„åé¢æ˜¯ä¸€ä¸ªé•¿åº¦ä¹Ÿä¸º **3** ä¸”åˆæ³•çš„è¯ç¼€
>         2. `s[1,i+5]` æ˜¯ä¸€ä¸ªåˆæ³•çš„è¯æ ¹ï¼Œå³ `f[i+5]` æ ‡è®°ä¸ºçœŸï¼Œå³åé¢çš„åé¢æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º **2** ä¸”åˆæ³•çš„è¯ç¼€
>
>     æ—¶é—´å¤æ‚åº¦ï¼š$O(n \log n)$ - `dp` çš„è¿‡ç¨‹æ˜¯çº¿æ€§çš„ï¼Œä¸»è¦æ—¶é—´å¼€é”€åœ¨ `set` çš„è‡ªåŠ¨æ’åºä¸Š

dfs ä»£ç 

```cpp
#include <iostream>
#include <cstring>
#include <vector>
#include <queue>
#include <stack>
#include <algorithm>
#include <unordered_map>
#include <set>
using namespace std;

string s;
set<string> res;

// å½“å‰è¯ç¼€èµ·å§‹ä¸‹æ ‡ idxï¼Œå½“å‰è¯ç¼€é•¿åº¦ lengthï¼Œåæ–¹ç›¸é‚»çš„è¯ç¼€ post
void dfs(int idx, int length, string post) {
    if (idx <= 5) return;
    
    string now = s.substr(idx, length);

    if (now == post) {
        // ä¸åˆæ³•ç›´æ¥è¿”å›
        return;
    } else {
        // åˆæ³•åˆ™å°†å½“å‰è¯ç¼€åŠ å…¥é›†åˆè‡ªåŠ¨æ’åºï¼Œå¹¶ç»§ç»­æœç´¢æ¥ä¸‹æ¥å¯èƒ½çš„è¯ç¼€
        res.insert(now);
        dfs(idx - 2, 2, now);
        dfs(idx - 3, 3, now);
    }
}

void solve() {
    cin >> s;
    s = "$" + s;
    
    int tail_point = s.size();

    dfs(tail_point - 2, 2, "");
    dfs(tail_point - 3, 3, "");
    
    cout << res.size() << "\n";
    for (auto& str: res) cout << str << "\n";
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

dp ä»£ç 

```cpp
#include <iostream>
#include <cstring>
#include <vector>
#include <queue>
#include <stack>
#include <algorithm>
#include <unordered_map>
#include <set>
using namespace std;

const int N = 50010;

string s;
set<string> res;
bool f[N]; // f[i] è¡¨ç¤º s[1,i] æ˜¯å¦å¯ä»¥ä½œä¸ºè¯æ ¹å­˜åœ¨

void solve() {
    cin >> s;
    s = "$" + s;
    
    // å­—ç¬¦ä¸²å®šä¹‰åœ¨ [1,n] ä¸Š
    int n = s.size() - 1;
    
    // é•¿åº¦ä¸º n çš„å­—ç¬¦ä¸²ä¸€å®šå¯ä»¥ä½œä¸ºè¯æ ¹
    f[n] = true;
    
    for (int i = n; i >= 5; i--) {
        for (int len = 2; len <= 3; len++) {
            if (f[i + len]) {
                string a = s.substr(i + 1, len);
                string b = s.substr(i + 1 + len, len);
                if (a != b || f[i + 5]) {
                    res.insert(a);
                    f[i] = true;
                }
            }
        }
    }
    
    cout << res.size() << "\n";
    
    for (auto& x: res) cout << x << "\n";
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

## çº¿æ€§ DP

çº¿æ€§ DP é¡¾åæ€ä¹‰å°±æ˜¯çŠ¶æ€æ•°ç»„æ˜¯çº¿æ€§çš„ã€‚æ³¨æ„ï¼š

- å­ä¸²æ˜¯è¿ç»­çš„ï¼›
- å­åºåˆ—å¯ä»¥ä¸æ˜¯è¿ç»­çš„ã€‚

## èƒŒåŒ… DP

## åŒºé—´ DP

## æ•°ä½ DP

## æ ‘å½¢ DP

## çŠ¶å‹ DP

## æ¦‚ç‡ DP

## è®¡æ•° DP

## åŠ¨æ€è§„åˆ’

### çº¿æ€§ dp

æœ€å°åŒ–ç½‘ç»œå¹¶å‘çº¿ç¨‹åˆ†é…

<https://vijos.org/d/nnu_contest/p/1492>

> é¢˜æ„ï¼šç°åœ¨æœ‰ä¸€ä¸ªçº¿æ€§ç½‘ç»œéœ€è¦åˆ†é…å¹¶å‘çº¿ç¨‹ï¼Œæ¯ä¸€ä¸ªç½‘ç»œæœ‰ä¸€ä¸ªæƒé‡ï¼Œç°åœ¨æœ‰ä¸€ä¸ªçº¿ç¨‹åˆ†é…è§„åˆ™ã€‚å¯¹äºå½“å‰ç½‘ç»œï¼Œå¦‚æœæƒé‡æ¯”ç›¸é‚»çš„ç½‘ç»œå¤§ï¼Œåˆ™çº¿ç¨‹å°±å¿…é¡»æ¯”ç›¸é‚»çš„ç½‘ç»œå¤§ã€‚
>
> æ€è·¯ï¼šæˆ‘ä»¬ä»ç­”æ¡ˆè§’åº¦æ¥çœ‹ï¼Œå¯¹äºä¸€ä¸ªç½‘ç»œï¼Œæˆ‘ä»¬æƒ³çŸ¥é“å®ƒçš„ç›¸é‚»çš„å·¦è¾¹çº¿ç¨‹æ•°å’Œå³è¾¹çº¿ç¨‹æ•°ï¼Œå¦‚æœå½“å‰ç½‘ç»œæ¯”å·¦è¾¹å’Œå³è¾¹çš„æƒé‡éƒ½å¤§ï¼Œåˆ™å°±æ˜¯å·¦å³çº¿ç¨‹æ•°çš„æœ€å¤§å€¼+1ï¼Œå½“ç„¶è¿™äº›çš„ **å‰ææ˜¯å·¦å³çº¿ç¨‹æ•°å·²ç»æ˜¯æœ€ä¼˜çš„çŠ¶æ€**ï¼Œå› æ­¤æˆ‘ä»¬è¦å…ˆæ±‚â€œå·¦å³çº¿ç¨‹â€ã€‚åˆ†æå¯çŸ¥ï¼Œå·¦çº¿ç¨‹åªå–å†³äºå·¦è¾¹çš„æƒé‡ä¸çº¿ç¨‹æ•°ï¼Œå³çº¿ç¨‹åŒæ ·åªå–å†³äºå³è¾¹çš„æƒé‡å’Œçº¿ç¨‹æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åŒå‘æ‰«æä¸€éå³å¯æ±‚å¾—â€œå·¦å³çº¿ç¨‹â€ã€‚æœ€åæ ¹æ®â€œå·¦å³çº¿ç¨‹â€å³å¯æ±‚å¾—æ¯ä¸€ä¸ªç‚¹çš„æœ€ä¼˜çŠ¶æ€ã€‚

```cpp
void solve() {
    int n; cin >> n;
    vector<int> w(n + 1), l(n + 1, 1), r(n + 1, 1);
    for (int i = 1; i <= n; i++) {
        cin >> w[i];
    }
    for (int i = 2, j = n - 1; i <= n && j >= 1; i++, j--) {
        if (w[i] > w[i - 1]) {
            l[i] = l[i - 1] + 1;
        }
        if (w[j] > w[j + 1]) {
            r[j] = r[j + 1] + 1;
        }
    }
    int res = 0;
    for (int i = 1; i <= n; i++) {
        res += max(l[i], r[i]);
    }
    cout << res << "\n";
}
```

Block Sequence

<https://codeforces.com/contest/1881/problem/E>

> é¢˜æ„ï¼šç»™å®šä¸€ä¸ªé•¿ä¸º $n\le 2\times 10^5$ çš„æ•°ç»„ aï¼Œé—®æœ€å°‘å¯ä»¥åˆ é™¤å…¶ä¸­çš„å‡ ä¸ªå…ƒç´ ï¼Œä½¿å¾—æœ€ç»ˆçš„æ•°ç»„å¯ä»¥è¢«åˆ’åˆ†ä¸ºè¿ç»­çš„å­æ•°ç»„ä¸”æ¯ä¸€ä¸ªå­æ•°ç»„çš„å…ƒç´ ä¸ªæ•°å‡ä¸ºã€Œå­æ•°ç»„é¦–å…ƒç´ æ•°å€¼ $-1$ã€çš„å½¢å¼ã€‚
>
> æ€è·¯ï¼š
>
> - é¦–å…ˆå¯ä»¥çœ‹å‡ºï¼Œåºåˆ—çš„é¦–å…ƒç´ ä¸€å®šæ˜¯å¯¹åº”å­æ•°ç»„å‰©ä½™å…ƒç´ çš„ä¸ªæ•°ã€‚æˆ‘ä»¬ä¸å¦¨å€’åºæšä¸¾æ¯ä¸€ä¸ªå…ƒç´ å¹¶å®šä¹‰ `f[i]` è¡¨ç¤ºä½¿æ•°ç»„ `a[i:]` ç¬¦åˆå®šä¹‰çš„æœ€å°åˆ é™¤æ¬¡æ•°ï¼Œè¿™æ ·æ¯æ¬¡æšä¸¾åˆ°çš„å…ƒç´ éƒ½ä¸€å®šæ˜¯æ‰€åœ¨å­æ•°ç»„çš„é¦–å…ƒç´ ã€‚
> - æ¥ä¸‹æ¥è€ƒè™‘çŠ¶æ€è½¬ç§»ã€‚å¯¹äºå½“å‰æšä¸¾åˆ°çš„å…ƒç´  `a[i]`ï¼Œå¦‚æœä¸åˆ é™¤ï¼Œåˆ™ `f[i]` å°†ä» `f[i+a[i]+1]` è½¬ç§»è¿‡æ¥ï¼›å¦‚æœåˆ é™¤ï¼Œåˆ™ `f[i]` å°†ä» `f[i+1]` è½¬ç§»è¿‡æ¥ã€‚ä¸¤è€…å–æœ€å°å€¼å³å¯ã€‚
>
> æ—¶é—´å¤æ‚åº¦ $O(n)$

```python
def solve() -> Optional:
    n = II()
    a = LII()
    f = [INF] * (n + 1)
    f[n] = 0
    for i in range(n - 1, -1, -1):
        f[i] = f[i + 1] + 1
        if i + a[i] + 1 <= n:
            f[i] = min(f[i], f[i + a[i] + 1])
    return f[0]
```

è¦†ç›–å¢™å£

<https://www.luogu.com.cn/problem/P1990>

> é¢˜æ„ï¼šç»™å®šä¸¤ç§ç –å—ï¼Œåˆ†åˆ«ä¸ºæ—¥å­—å‹ä¸ L å‹ï¼Œé—®é“ºæ»¡ $2*n$ çš„åœ°æ¿ä¸€å…±æœ‰å¤šå°‘ç§é“ºæ³•
>
> æ€è·¯ï¼š
>
> - æˆ‘ä»¬é‡‡ç”¨é€’æ¨çš„æ€è·¯
> - $define:$ `f[i]` è¡¨ç¤ºé“ºæ»¡å‰ $2*i$ ä¸ªåœ°æ¿çš„æ–¹æ¡ˆæ•°ï¼Œ`g[i]` è¡¨ç¤ºé“ºæ»¡å‰ $2*i+1$ å—åœ°æ¿çš„æ–¹æ¡ˆæ•°
> - $base:$ `f[0] = 1, f[1] = 1, g[0] = 0, g[1] = 1`
> - $dp:$ `f[i] = f[i-1] + f[i-2] + g[i-1]` $||$ `g[i] = f[i-1] + g[i-1]`
> - $result:$ `f[n]`
>
> æ‰‹ç»˜ï¼š
>
> ![å›¾ä¾‹](https://cdn.dwj601.cn/images/202402012332894.png)
>
> ![å›¾ä¾‹](https://cdn.dwj601.cn/images/202403181626377.png)

```cpp
#include <bits/stdc++.h>
using namespace std;

const int N = 1000010, mod = 10000;

int n;
int f[N], g[N];

void solve() {
    cin >> n;

    // base
    f[0] = 1, f[1] = 1;
    g[0] = 0, g[1] = 1;

    // dp
    for (int i = 2; i <= n; i++) {
        f[i] = (f[i - 1] + f[i - 2] + 2 * g[i - 2]) % mod;
        g[i] = (f[i - 1] + g[i - 1]) % mod;
    }

    // result
    cout << f[n] << "\n";
}

int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

æ–½å’’çš„æœ€å¤§æ€»ä¼¤å®³

<https://leetcode.cn/problems/maximum-total-damage-with-spell-casting/>

> æ ‡ç­¾ï¼šçº¿æ€§ dp
>
> é¢˜æ„ï¼šç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œé€‰æ‹©ä¸€ä¸ªå­åºåˆ—ä½¿å¾—æ€»å’Œæœ€å¤§ã€‚çº¦æŸä¸ºï¼šå¦‚æœé€‰æ‹©äº†å€¼ä¸º $x$ çš„å…ƒç´ ï¼Œåˆ™ä¸å…è®¸é€‰æ‹©å€¼ä¸º $x-2,x-1,x+1,x+2$ çš„å…ƒç´ 
>
> æ€è·¯ï¼š
>
> - å“ˆå¸Œè®¡æ•°ã€‚é¦–å…ˆå¾ˆæ˜¾ç„¶çš„æˆ‘ä»¬éœ€è¦è¿›è¡Œå“ˆå¸Œè®¡æ•°ï¼Œä¾¿äºæŒ‰æ•°å€¼å‡åºæšä¸¾å…ƒç´ ã€‚æˆ‘ä»¬å®šä¹‰å“ˆå¸Œåçš„åºåˆ—ä¸º `v`ï¼Œå¤§å°ä¸º `m`ï¼Œå­˜å‚¨æ¯ä¸€ç§æ•°çš„æ•°å€¼ `val: int` å’Œä¸ªæ•° `cnt: int`
> - çŠ¶æ€å®šä¹‰ã€‚æˆ‘ä»¬å®šä¹‰çŠ¶æ€ `f[i]` è¡¨ç¤ºå“ˆå¸Œåºåˆ— `[1,i]` ä¸­å­åºåˆ—æ€»å’Œçš„æœ€å¤§å€¼ï¼Œåˆ™æœ€ç»ˆç­”æ¡ˆå°±æ˜¯ `f[m]`
> - çŠ¶æ€è½¬ç§»ã€‚å¯¹äºæ¯ä¸€ä¸ªå“ˆå¸Œå…ƒç´ ï¼Œéƒ½æœ‰é€‰æ‹©å’Œä¸é€‰ä¸¤ç§çŠ¶æ€ã€‚å‡è®¾å½“å‰æšä¸¾åˆ°çš„å“ˆå¸Œå…ƒç´ ä¸º `i`ï¼Œ
>     - ä¸é€‰å½“å‰å…ƒç´ ã€‚å°±ç›¸å½“äºæ²¡æœ‰å½“å‰å…ƒç´ ï¼Œåˆ™ `f[i] = f[i-1]`
>     - é€‰æ‹©å½“å‰å…ƒç´ ã€‚æˆ‘ä»¬å°±éœ€è¦ä»å“ˆå¸Œåºåˆ— `[1,i-1]` ä¸­ï¼Œæ¯”å½“å‰å“ˆå¸Œå…ƒç´  `v[i].val` å° 2 ä¸”å¯¹åº”å­åºåˆ—ä¹‹å’Œæœ€å¤§çš„é‚£ä¸ªçŠ¶æ€ `f[j]` è½¬ç§»è¿‡æ¥ã€‚æ˜¾ç„¶æˆ‘ä»¬å¯ä»¥ç›´æ¥æšä¸¾å“ˆå¸Œåºåˆ— `[1,i-1]`ï¼Œä½†æ˜¯è¿™æ ·å°±æ˜¯ $O(n^2)$ å¿…ç„¶è¶…æ—¶ï¼Œè€ƒè™‘ä¼˜åŒ–ã€‚ä¸éš¾å‘ç° `f[]` æ•°ç»„æ˜¯å•è°ƒé€’å¢çš„å¹¶ä¸”å“ˆå¸Œåºåˆ—çš„å…ƒç´ æ•°å€¼ `v[].val` ä¹Ÿæ˜¯å•è°ƒé€’å¢çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹äºå½“å‰çŠ¶æ€ `f[i]`ï¼Œåœ¨æšä¸¾å“ˆå¸Œåºåˆ— `[1,i-1]` æ—¶ï¼Œå…¶å®å¹¶ä¸éœ€è¦ä» `1` å¼€å§‹æšä¸¾ï¼Œå¯ä»¥ä»ä¸Šä¸€ä¸ªçŠ¶æ€æšä¸¾åˆ°çš„çŠ¶æ€ï¼ˆè®°ä½œ `j`ï¼‰å¼€å§‹æšä¸¾ï¼ˆå› ä¸ºä¸Šä¸€ä¸ªçŠ¶æ€å¯¹åº”çš„ `f[j]` æ˜¯ä¸Šä¸€ä¸ªçŠ¶æ€å¯è½¬ç§»çš„æ–¹æ¡ˆä¸­æœ€å¤§çš„å¹¶ä¸” `v[j].val` ä¸€å®šæ¯”å½“å‰æ–¹æ¡ˆçš„å“ˆå¸Œæ•°å€¼ `v[i].val` å° 2ï¼‰ã€‚äºæ˜¯çŠ¶æ€è½¬ç§»çš„æ—¶é—´å¼€é”€å°±ä» $O(n)$ ä¼˜åŒ–åˆ° $O(1)$ï¼Œå¯ä»¥é€šè¿‡æ­¤é¢˜
>
> æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$
>
> ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

```cpp
class Solution {
public:
    long long maximumTotalDamage(vector<int>& power) {
        using ll = long long;

        // hash
        map<int, int> a;
        for (int x: power) {
            a[x]++;
        }
        int m = a.size(), idx = 1;
        struct node { ll val, cnt; };
        vector<node> v(m + 1);
        for (auto it: a) {
            v[idx++] = {it.first, it.second};
        }

        // dp
        vector<ll> f(m + 1);
        f[1] = v[1].val * v[1].cnt;
        for (int i = 2, j = 1; i <= m; i++) {
            while (j < i && v[j].val < v[i].val - 2) {
                j++;
            }
            j--;
            
            f[i] = max(f[i - 1], f[j] + v[i].val * v[i].cnt);
        }

        return f[m];
    }
};
```

```python
class Solution:
    def maximumTotalDamage(self, power: List[int]) -> int:
        from collections import defaultdict

        # hash
        a = defaultdict(int)
        for x in power:
            a[x] += 1
        a = sorted(a.items(), key=lambda x: x[0])

        class node:
            def __init__(self, val: int, cnt: int) -> None:
                self.val = val
                self.cnt = cnt
        
        m, idx = len(a), 1
        v = [node(0, 0)] * (m + 1)
        for it in a:
            v[idx] = node(it[0], it[1])
            idx += 1

        # dp
        f = [0] * (m + 1)
        f[1], j = v[1].val * v[1].cnt, 1
        for i in range(2, m + 1):
            while j < i and v[j].val < v[i].val - 2:
                j += 1
            j -= 1

            f[i] = max(f[i - 1], f[j] + v[i].val * v[i].cnt)

        return f[m]
```

å¥‡æ€ªçš„æ±‰è¯ºå¡”

<https://www.acwing.com/problem/content/98/>

> é¢˜æ„ï¼šå››å¡”æ±‰è¯ºå¡”é—®é¢˜ã€‚æ±‚åœ¨ç»™å®š $n$ ä¸ªåœ†ç›˜çš„æƒ…å†µä¸‹çš„æœ€å°‘ç§»åŠ¨æ–¹æ¡ˆæ•°ã€‚
>
> æ€è·¯ï¼š
>
> - æˆ‘ä»¬å®šä¹‰ã€Œæœ€å°å®Œæˆå•å…ƒã€ä¸ºï¼šåœ¨æ»¡è¶³æ¸¸æˆè§„åˆ™çš„æƒ…å†µä¸‹ï¼Œå°†ä¸€åº§å¡”çš„æ‰€æœ‰åœ†ç›˜ç§»åŠ¨åˆ°å¦ä¸€åº§å¡”æ‰€éœ€çš„æœ€å°‘å¡”æ•°ã€‚é‚£ä¹ˆæ˜¾ç„¶çš„æœ€å°å®Œæˆå•å…ƒä¸º 3 åº§å¡”ã€‚å®šä¹‰ `d[i]` è¡¨ç¤ºä¸‰å¡”æ¨¡å¼ä¸‹ $i$ ä¸ªç›˜çš„æœ€å°‘ç§»åŠ¨æ¬¡æ•°ï¼Œ`f[i]` è¡¨ç¤ºå››å¡”æ¨¡å¼ä¸‹ $i$ ä¸ªç›˜çš„æœ€å°‘ç§»åŠ¨æ¬¡æ•°ã€‚
>
> - å¯¹äº 4 åº§å¡”çš„æƒ…å†µï¼Œç›¸å½“äºæœ€å°å®Œæˆå•å…ƒåˆå¤šäº† 1 åº§å¡”ã€‚é‚£ä¹ˆæ˜¾ç„¶å¤šå‡ºæ¥çš„è¿™åº§å¡”æœ‰ä¸¤ä¸ªå¤„ç½®æ–¹æ¡ˆï¼š
>
>     - å¦‚æœæˆ‘ä»¬ **ä¸åˆ©ç”¨** è¿™åº§å¡”ã€‚é‚£ä¹ˆè¿˜å‰© 3 åº§å¡”ï¼Œä¹Ÿå°±æ˜¯æœ€å°å®Œæˆå•å…ƒï¼Œæ­¤æ—¶çš„æœ€å°‘ç§»åŠ¨æ¬¡æ•°æ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿå°±æ˜¯ `f[i] = d[i]`
>
>     - å¦‚æœæˆ‘ä»¬ **è¦åˆ©ç”¨** è¿™åº§å¡”ã€‚é‚£ä¹ˆæˆ‘ä»¬ **åªèƒ½åœ¨è¿™ä¸€åº§å¡”ä¸Š** æŒ‰è§„åˆ™æ”¾åœ†ç›˜ã€‚å› ä¸ºè¦ç¡®ä¿æœ€å°å®Œæˆå•å…ƒæ¥è®©å‰©ä½™çš„åœ†ç›˜ç§»åŠ¨åˆ°å¦ä¸€åº§å¡”ã€‚å¦‚æœè¿˜åœ¨åˆ«çš„å¡”ä¸Šæ”¾ç½®äº†åœ†ç›˜ï¼Œé‚£ä¹ˆå°†ä¸ç¬¦åˆæœ€å°å®Œæˆå•å…ƒçš„å®šä¹‰ï¼Œæ¸¸æˆæ— æ³•ç»“æŸã€‚å½“ç„¶æˆ‘ä»¬ä¸èƒ½å°†æ‰€æœ‰çš„åœ†ç›˜éƒ½å…ˆæ”¾åˆ°è¿™åº§å¡”ä¸Šï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¸‹æ˜¯ä¸å¯èƒ½æˆç«‹çš„ï¼Œæˆ‘ä»¬ä¸å¯èƒ½è®©ä¸€ä¸ªã€Œæˆ‘ä»¬æ­£åœ¨æ±‚è§£çš„é—®é¢˜ã€ä½œä¸ºæˆ‘ä»¬çš„ç­”æ¡ˆã€‚ä¹Ÿå°±æ˜¯è¯´ $j<i$
>
>
> - è‡³æ­¤å››å¡”æ¨¡å¼ä¸‹ $i$ ä¸ªåœ†ç›˜æ¸¸æˆæ–¹æ¡ˆçš„ç»„æˆé›†åˆå·²å…¨éƒ¨ç¡®å®šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå³ï¼šåœ¨å››å¡”æ¨¡å¼ä¸‹ç§»åŠ¨ $j \in [0,i-1]$ ä¸ªåœ†ç›˜åˆ°å…¶ä¸­ä¸€åº§ç©ºå¡”ä¸Šï¼Œæ–¹æ¡ˆæ•°ä¸º $f[j]$ï¼›å‰©ä½™çš„ $i-j$ ä¸ªåœ†ç›˜å¤„äºæœ€å°å®Œæˆå•å…ƒçš„å±€é¢ï¼Œæ–¹æ¡ˆæ•°æ˜¯å”¯ä¸€çš„ $d[i-j]$ï¼›æœ€åå†å°†ä¸€å¼€å§‹ç§»åŠ¨çš„ $j$ ä¸ªåœ†ç›˜åœ¨å››å¡”æ¨¡å¼ä¸‹ç§»åŠ¨åˆ°åˆšæ‰å‰©ä½™åœ†ç›˜ç§»åŠ¨åˆ°çš„å¡”ä¸Šï¼Œæ–¹æ¡ˆæ•°ä¸º $f[j]$ã€‚
>
> ![é›†åˆåˆ’åˆ†](https://cdn.dwj601.cn/images/202408011452431.png)
>
> äºæ˜¯æœ€ç»ˆçš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ä¸ºï¼š
>
> $$
> f_i = \min{ \{ f_j+d_{i-j}+f_j \} },\quad i \in [1, n],\quad j \in [0, i-1]
> $$
>
> æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$

```cpp
#include <bits/stdc++.h>

using ll = long long;
using namespace std;

void solve() {
    int n = 12;
    vector<int> d(n + 1);       // d[i] means move i pans to another tower with 3 towers
    vector<int> f(n + 1, 1e9);  // f[i] means move i pans to another tower with 4 towers
    
    d[1] = 1;
    for (int i = 1; i <= n; i++) {
        d[i] = 1 + 2 * d[i - 1];
    }
    f[1] = 1;
    for (int i = 1; i <= n; i++) {
        for (int j = 0; j <= i - 1; j++) {
            f[i] = min(f[i], f[j] + d[i - j] + f[j]);
        }
        cout << f[i] << "\n";
    }
}

signed main() {
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr);
    int T = 1;
//    std::cin >> T;
    while (T--) solve();
    return 0;
}
```

æ•°çš„è®¡ç®—

<https://www.luogu.com.cn/problem/P1028>

> é¢˜æ„ï¼šç»™å®šä¸€ä¸ªæ•°å’Œä¸€ç§æ„é€ æ–¹æ³•ï¼Œå³å¯¹äºå½“å‰çš„æ•°ï¼Œå¯ä»¥åœ¨å…¶åé¢æ·»åŠ ä¸€ä¸ªæœ€å¤§ä¸ºå½“å‰ä¸€åŠå¤§çš„æ•°ï¼Œä»¥æ­¤ç±»æ¨æ„é€ æˆä¸€ä¸ªæ•°åˆ—ã€‚é—®ä¸€å…±å¯ä»¥æ„é€ å‡ºå¤šå°‘ä¸ªè¿™ç§æ•°åˆ—
>
> æ€è·¯ä¸€ï¼šdfs
>
> - éå¸¸æ˜¾ç„¶çš„ä¸€ä¸ªæœç´¢æ ‘ï¼Œç­”æ¡ˆå°±æ˜¯ç»“ç‚¹æ•°
> - æ—¶é—´å¤æ‚åº¦ï¼š$O(\text{æ–¹æ¡ˆæ•°})$
>
> æ€è·¯äºŒï¼šdp
>
> - éå¸¸æ˜¾ç„¶çš„ä¸€ä¸ª dpï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª dp è®°å¿†æ•°ç»„ã€‚å…¶ä¸­ `dp[i]` è¡¨ç¤ºæ•°å­— `i` çš„æ„é€ æ–¹æ¡ˆæ€»æ•°ï¼Œé‚£ä¹ˆçŠ¶æ€è½¬ç§»æ–¹ç¨‹å°±æ˜¯
>
>     $$
>     dp [i] =\sum_{j = 1}^{\left\lfloor i/2 \right\rfloor}dp [j]+1
>     $$
>
> - æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$

dfs ä»£ç 

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

int n, res;

void dfs(int x) {
    res++;
    for (int i = x >> 1; i >= 1; i--) {
        dfs(i);
    }
}

void solve() {
    cin >> n;
    dfs(n);
    cout << res << "\n";
}

signed main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

dp ä»£ç 

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

int n;

void solve() {
    cin >> n;

    vector<ll> dp(n + 1, 1);
    for (int i = 2; i <= n; i++) {
        for (int j = 1; j <= i >> 1; j++) {
            dp[i] += dp[j];
        }
    }

    cout << dp[n] << "\n";
}

signed main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

è§„åˆ’å…¼èŒå·¥ä½œ

<https://leetcode.cn/problems/maximum-profit-in-job-scheduling/description/>

> æ ‡ç­¾ï¼šçº¿æ€§ dpã€äºŒåˆ†ç­”æ¡ˆ
>
> é¢˜æ„ï¼šç»™å®š n ä»½å·¥ä½œçš„èµ·å§‹æ—¶é—´ã€ç»ˆæ­¢æ—¶é—´ã€æ”¶ç›Šå€¼ï¼Œç°åœ¨éœ€è¦ä¸é‡å æ—¶é—´çš„é€‰æ‹©å·¥ä½œä½¿å¾—æ”¶ç›Šæœ€å¤§
>
> æ€è·¯ï¼šåŠ¨æ€è§„åˆ’ã€äºŒåˆ†ç­”æ¡ˆã€‚ä¸ºäº†ä¸é‡ä¸æ¼çš„æšä¸¾æ¯ä¸€ä»½å·¥ä½œï¼Œæˆ‘ä»¬å°†å·¥ä½œæŒ‰ç…§ç»“æŸæ—¶é—´è¿›è¡Œæ’åºï¼Œç„¶åå°±å¯ä»¥æšä¸¾æ¯ä¸€ä»½å·¥ä½œäº†ã€‚æ¥ä¸‹æ¥è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•æ ¹æ®èµ·å§‹æ—¶é—´å’Œç»ˆæ­¢æ—¶é—´è¿›è¡Œå·¥ä½œçš„é€‰æ‹©ã€‚æ˜¾ç„¶çš„ï¼Œæ¯ä¸€ä»½å·¥ä½œæœ‰é€‰ä¸ä¸é€‰ä¸¤ç§çŠ¶æ€ï¼Œæ˜¯å¦é€‰æ‹©å–å†³äºæ”¶ç›Šæ˜¯å¦æ›´ä¼˜ï¼Œæˆ‘ä»¬è€ƒè™‘åŠ¨æ€è§„åˆ’ã€‚æˆ‘ä»¬å®šä¹‰çŠ¶æ€è¡¨ `f[i]` è¡¨ç¤ºåœ¨å‰ i ä¸ªå·¥ä½œä¸­é€‰æ‹©çš„æœ€å¤§å·¥ä½œæ”¶ç›Šï¼Œè¿”å›å€¼å°±æ˜¯ `f[n]`ï¼Œå…ˆçœ‹å›¾
>
> ![å›¾ä¾‹](https://cdn.dwj601.cn/images/202405281439070.png)
>
> 1. é€‰æ‹©ç¬¬ i ä¸ªå·¥ä½œï¼š`f[i] = f[r] + profit[i]`ï¼ˆå…¶ä¸­ r è¡¨ç¤º `[1,i-1]` ä»½å·¥ä½œä¸­ï¼Œç»“æŸæ—¶é—´æ—©äºå½“å‰å·¥ä½œèµ·å§‹æ—¶é—´çš„æœ€å³è¾¹çš„å·¥ä½œï¼Œåœ¨ `[1,i-1]` ä¸­äºŒåˆ†æŸ¥æ‰¾å³å¯ï¼‰
> 2. ä¸é€‰ç¬¬ i ä¸ªå·¥ä½œï¼š`f[i] = f[i - 1]`
>
> é€‰æ‹©æœ€å¤§å±æ€§è¿›è¡ŒçŠ¶æ€è½¬ç§»å³å¯ï¼š`f[i] = max(f[i - 1], f[r] + profit[i])`
>
> æ—¶é—´å¤æ‚åº¦ï¼š$O(n\log n)$

```cpp
class Solution {
public:
    int jobScheduling(vector<int>& startTime, vector<int>& endTime, vector<int>& profit) {
        int n = startTime.size();
        vector<array<int, 3>> jobs(n + 1);

        for (int i = 1; i <= n; i++) {
            jobs[i] = {startTime[i - 1], endTime[i - 1], profit[i - 1]};
        }

        sort(jobs.begin() + 1, jobs.end(), [&](array<int, 3>& x, array<int, 3>& y){
            return x[1] < y[1];
        });

        vector<int> f(n + 1);
        for (int i = 1; i <= n; i++) {
            int l = 0, r = i - 1;
            while (l < r) {
                int mid = (l + r + 1) >> 1;
                if (jobs[mid][1] <= jobs[i][0]) l = mid;
                else r = mid - 1;
            }
            f[i] = max(f[i - 1], f[r] + jobs[i][2]);
        }

        return f[n];
    }
};
```

æœ€é•¿ä¸Šå‡å­åºåˆ—

<https://www.luogu.com.cn/problem/B3637>

> æ ‡ç­¾ï¼šçº¿æ€§ dpã€äºŒåˆ†æŸ¥æ‰¾
>
> é¢˜æ„ï¼šç»™å®šåºåˆ—ï¼Œæ±‚è§£å…¶ä¸­æœ€é•¿ä¸Šå‡å­åºåˆ— (Longest Increasing Subsequence, ç®€ç§° LIS) çš„é•¿åº¦ã€‚
>
> æ€è·¯ï¼šæˆ‘ä»¬é‡‡ç”¨åŠ¨æ€è§„åˆ’ã€‚
>
> **çŠ¶æ€å®šä¹‰**ï¼šå®šä¹‰çŠ¶æ€æ•°ç»„ `f[i]` è¡¨ç¤ºä»¥å…ƒç´  `a[i]` ç»“å°¾çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ï¼Œæ˜¾ç„¶çš„åˆå§‹çŠ¶æ€å…¨éƒ½æ˜¯ `1`
>
> **çŠ¶æ€è½¬ç§»**ï¼š
>
> - **æš´åŠ›æšä¸¾**ã€‚é¦–å…ˆå¾ˆæ˜¾ç„¶çš„ `f[i]` ä¸€å®šæ˜¯ä» `[0,i-1]` ä¸­æ¯”å½“å‰å…ƒç´ å€¼å°çš„çŠ¶æ€è½¬ç§»è¿‡æ¥ï¼Œäºæ˜¯å¯ä»¥å¾ˆè½»æ¾çš„å†™å‡ºåŒé‡å¾ªç¯çš„ä»£ç ï¼Œæ—¶é—´å¤æ‚åº¦ $O(n^2)$ã€‚
>
> - **è´ªå¿ƒ+äºŒåˆ†ä¼˜åŒ–**ã€‚
>
>     - **å›é¡¾æœ´ç´ **ã€‚ä¼˜åŒ–éœ€è¦åœ¨ç†è§£è½¬ç§»æœ¬è´¨çš„åŸºç¡€ä¸Šå±•å¼€ï¼Œå› æ­¤æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹æœ´ç´ ç‰ˆçš„è½¬ç§»æ–¹æ¡ˆï¼šä» `[0,i-1]` ä¸­æ¯”å½“å‰å…ƒç´ å°çš„å…ƒç´  `a[j]` å¯¹åº”çš„æœ€é•¿ä¸Šå‡å­åºåˆ—é•¿åº¦ `f[j]` è½¬ç§»è¿‡æ¥ã€‚æˆ‘ä»¬æšä¸¾äº† `[0,i-1]` æ‰€æœ‰çš„çŠ¶æ€ç¡®ä¿äº†ä¸é‡ä¸æ¼ã€‚å¯¹äº `i = 6` æ¥è¯´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…¶ä¸­ âœ” è¡¨ç¤ºè¿›å…¥äº† `if` çš„åˆ¤æ–­é€»è¾‘ã€‚æœ€ç»ˆæˆ‘ä»¬é€‰æ‹©ä» `j = 5` å¯¹åº”çš„ `f[j] = 3` è½¬ç§»è€Œæ¥ã€‚è¿™é‡Œçš„åˆ¤æ–­å‡†åˆ™ä¸ºï¼šå¯¹äºæ¯ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦æ‰¾å‰é¢çš„å…ƒç´ ä¸­æ¯”å½“å‰å…ƒç´ å°çš„å…ƒç´ ã€‚
>
>         ![æšä¸¾å…ƒç´ ](https://cdn.dwj601.cn/images/202406211528778.png)
>
>     - **è½¬æ¢è§†è§’**ã€‚åŒæ ·å¯¹äºæ¯ä¸€ä¸ªå…ƒç´  `a[i]`ï¼Œæˆ‘ä»¬ä¸å†æŒ‰é¡ºåºæšä¸¾å‰é¢å·²ç»è®¡ç®—å‡ºæ¥çš„ `f[1:i-1]`ï¼Œè€Œæ˜¯é¢„å…ˆæŒ‰ç…§é•¿åº¦å­˜å‚¨æ‰€æœ‰çš„ `f[1:i-1]` ä»è€Œæšä¸¾é•¿åº¦ `j`ï¼Œæ˜¾ç„¶å¯ä»¥è´ªå¿ƒçš„ä»æœ€å¤§é•¿åº¦ `mxa_len` å¼€å§‹æšä¸¾ã€‚ä¸€æ—¦é‡åˆ°æ¯” `a[i]` å°çš„å…ƒç´ ï¼Œé‚£ä¹ˆ `f[i]` å°±ç­‰äºå½“å‰æšä¸¾çš„é•¿åº¦+1ï¼Œå³ `f[i] = j + 1`ã€‚å¯¹äº `i = 6` æ¥è¯´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¿™æ ·ä¹Ÿå¯ä»¥åšåˆ°ä¸é‡ä¸æ¼çš„æšä¸¾æ‰€æœ‰çŠ¶æ€ã€‚ä½†æ˜¯æ˜¾ç„¶çš„ï¼Œè¿™ç§æ–¹æ³•åªæ˜¯å˜ç›¸åœ°æšä¸¾äº†æ‰€æœ‰çš„å…ƒç´ ï¼Œä»ç„¶æ˜¯ $O(n^2)$ï¼Œå¹¶ä¸”å’Œæšä¸¾å…ƒç´ ç›¸æ¯”è¿˜å¤šäº†ä¸€ç‚¹æ€ç»´é‡å’Œä»£ç é‡ã€‚
>
>         ![æšä¸¾é•¿åº¦](https://cdn.dwj601.cn/images/202406211532051.png)
>
>     - **ä¼˜åŒ–è¯ç”Ÿ**ã€‚åœ¨æšä¸¾å…ƒç´ æ—¶ï¼Œå¹¶æ²¡æœ‰é¢å¤–æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å…ƒç´ å¹¶éå•è°ƒæ’åˆ—ï¼Œ`f[]` æ•°ç»„ä¹Ÿå¹¶éå•è°ƒã€‚ä½†è½¬æ¢åˆ°æšä¸¾é•¿åº¦ï¼Œè®©æˆ‘ä»¬æœ‰æœºä¼šè¿›è¡Œä¼˜åŒ–ï¼ä¸éš¾å‘ç°ï¼Œå¯¹äºæ¯ä¸€ä¸ªå…ƒç´  `a[i]`ï¼Œæˆ‘ä»¬åœ¨æŒ‰é•¿åº¦ `[1,max_len]` æšä¸¾å¯èƒ½çš„å°¾å…ƒç´  `f[1:i-1]` æ—¶ï¼Œç”±äº `max_len` æ¯ä¸€æ¬¡æ›´æ–°æ—¶çš„å¢é‡éƒ½æ˜¯ 1ï¼Œå› æ­¤ `[1,max_len]` çš„æ¯ä¸€ä¸ªå–å€¼éƒ½ä¸€å®šä¼šæœ‰å¯¹åº”çš„å…ƒç´ å­˜åœ¨ï¼è´ªå¿ƒçš„ï¼Œå¯¹äºåŒä¸€ä¸ªé•¿åº¦ä¸‹æ‰€æœ‰å­åºåˆ—çš„å°¾å…ƒç´ ï¼Œæˆ‘ä»¬åªå…³å¿ƒå…¶ä¸­å€¼æœ€å°çš„é‚£ä¸€ä¸ªå°¾å…ƒç´ ï¼Œå› æ­¤æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª `mi[]` æ•°ç»„æ¥å­˜å‚¨æ¯ä¸€ä¸ªé•¿åº¦ä¸‹å­åºåˆ—å°¾å…ƒç´ çš„æœ€å°å€¼ï¼Œå…¶ä¸­ `mi[i]` è¡¨ç¤ºé•¿åº¦ä¸º `i` çš„æœ€é•¿ä¸Šå‡å­åºåˆ—ä¸­ï¼Œæœ€å°çš„å°¾å…ƒç´ å€¼ã€‚è¿™æ ·åœ¨æšä¸¾é•¿åº¦ `[1,max_len]` æ—¶ï¼Œå°±ä¸å†éœ€è¦æšä¸¾æ¯ä¸€ä¸ªé•¿åº¦ä¸‹æ‰€æœ‰çš„å°¾å…ƒç´ ï¼Œä»…éœ€æšä¸¾æ¯ä¸€ä¸ªé•¿åº¦ä¸‹å”¯ä¸€çš„é‚£ä¸ªæœ€å°å°¾å…ƒç´ ã€‚ä½†å¦‚æœæ¯ä¸€ä¸ªé•¿åº¦éƒ½åˆšå¥½åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£å²‚ä¸æ˜¯è¿˜æ˜¯éœ€è¦çº¿æ€§æšä¸¾ï¼Ÿæ›´è¿›ä¸€æ­¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ­¤æ—¶æ¯ä¸€ä¸ªé•¿åº¦å¯¹åº”çš„å”¯ä¸€å…ƒç´ ç»„æˆçš„åºåˆ—æ˜¯ä¸¥æ ¼å•è°ƒé€’å¢çš„ï¼ˆåè¯æ³•æ˜“è¯ï¼‰ï¼æœ‰äº†è¿™æ ·å•è°ƒçš„æ€§è´¨æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨äºŒåˆ†åŠ é€Ÿæšä¸¾ï¼Œè¿™æ ·å¯ä»¥å°†æšä¸¾çš„æ—¶é—´å¤æ‚åº¦ä¸¥æ ¼æ§åˆ¶åœ¨ $O(\log n)$ã€‚æ˜¾ç„¶çš„ï¼Œæˆ‘ä»¬å¸Œæœ›å½“å‰çš„å…ƒç´ å¯ä»¥æ‹¼æ¥åœ¨å°½å¯èƒ½é•¿çš„å­åºåˆ—åé¢ï¼Œå› æ­¤æ­¤å¤„çš„äºŒåˆ†ä½¿ç”¨çš„æ˜¯å¯»æ‰¾å³è¾¹ç•Œçš„æ¿å­ã€‚
>
>         ![ä¼˜åŒ–](https://cdn.dwj601.cn/images/202406211532875.png)
>
>     - **ä»£ç å®ç°**ã€‚æšä¸¾æ¯ä¸€ä¸ªå…ƒç´ è‚¯å®šæ˜¯å°‘ä¸äº†çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ `mi[j]` è¡¨ç¤ºæœ€é•¿ä¸Šå‡å­åºåˆ—é•¿åº¦ä¸º `j` çš„åºåˆ—å°¾å…ƒç´ çš„æœ€å°å€¼ã€‚åˆå§‹çŠ¶æ€æ˜¾ç„¶å°±æ˜¯ `mi[1] = a[0]`ã€‚åœ¨æ¯ä¸€ä¸ªå…ƒç´ äºŒåˆ†æŸ¥è¯¢ã€Œæœ€å¤§çš„æ¯”å½“å‰å…ƒç´ å°çš„å…ƒç´ ã€æ—¶ï¼Œå¦‚æœæŸ¥å‡ºæ¥çš„å…ƒç´  `mi[r]` ç¡®å®æ¯”å½“å‰å…ƒç´ å°ï¼Œåˆ™éœ€è¦æ›´æ–° `mi[r+1]` çš„å€¼ï¼›åä¹‹å¦‚æœæŸ¥å‡ºæ¥çš„å…ƒç´  `mi[r]` æ¯”å½“å‰å…ƒç´ è¿˜å°ï¼Œåˆ™è¡¨æ˜äºŒåˆ†åˆ°äº†å·¦è¾¹ç•Œï¼Œæ­¤æ—¶ `r` ä¸€å®šæ˜¯ 1ï¼Œç›´æ¥ç”¨å½“å‰å…ƒç´ è¦†ç›– `mi[1]` å³å¯ã€‚
>
> **ç­”æ¡ˆè¡¨ç¤º**ã€‚æœ€ç»ˆç­”æ¡ˆå°±æ˜¯ `max_len`
>
> æ—¶é—´å¤æ‚åº¦ï¼š$O(n \log n)$

æš´åŠ›æšä¸¾å…ƒç´ 

```cpp
#include <bits/stdc++.h>

using ll = long long;
using namespace std;

void solve() {
    int n;
    cin >> n;

    vector<int> a(n);
    for (int i = 0; i < n; i++) {
        cin >> a[i];
    }

    vector<int> f(n, 1);
    for (int i = 0; i < n; i++) {
        for (int j = 0; j < i; j++) {
            if (a[i] > a[j]) {
                f[i] = max(f[i], f[j] + 1);
            }
        }
    }

    cout << *max_element(f.begin(), f.end()) << "\n";
}

signed main() {
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr);
    int T = 1;
//    std::cin >> T;
    while (T--) solve();
    return 0;
}
```

æš´åŠ›æšä¸¾é•¿åº¦

```cpp
#include <bits/stdc++.h>

using ll = long long;
using namespace std;

void solve() {
    int n;
    cin >> n;

    vector<int> a(n);
    for (int i = 0; i < n; i++) {
        cin >> a[i];
    }

    vector<vector<int>> dp(n + 1, vector<int>());
    int max_len = 1;
    dp[1].push_back(a[0]);
    for (int i = 1; i < n; i++) {
        bool ok = false;
        // è´ªå¿ƒçš„ä»å·²ç»å‡ºç°è¿‡çš„æœ€å¤§é•¿åº¦å¼€å§‹æšä¸¾
        for (int j = max_len; j >= 1; j--) {
            // å¯¹äºå½“å‰é•¿åº¦ä¸‹çš„æ‰€æœ‰å…ƒç´ 
            for (int x: dp[j]) {
                if (a[i] > x) {
                    dp[j + 1].push_back(a[i]);
                    max_len = max(max_len, j + 1);
                    ok = true;
                    goto flag;
                }
            }
        }
        flag:
        if (!ok) {
            dp[1].push_back(a[i]);
        }
    }

    cout << max_len << "\n";
}

signed main() {
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr);
    int T = 1;
//    std::cin >> T;
    while (T--) solve();
    return 0;
}
```

è´ªå¿ƒäºŒåˆ†ä¼˜åŒ–

```cpp
#include <bits/stdc++.h>

using ll = long long;
using namespace std;

void solve() {
    int n;
    cin >> n;

    vector<int> a(n);
    for (int i = 0; i < n; i++) {
        cin >> a[i];
    }

    vector<int> mi(n + 1, INT_MAX);
    int max_len = 1;
    mi[1] = a[0];
    for (int i = 1; i < n; i++) {
        int l = 1, r = max_len;
        while (l < r) {
            int mid = (l + r + 1) >> 1;
            if (a[i] > mi[mid]) l = mid;
            else r = mid - 1;
        }

        if (a[i] > mi[r]) {
            mi[r + 1] = min(mi[r + 1], a[i]);
            max_len = max(max_len, r + 1);
        } else {
            // æ­¤æ—¶é•¿åº¦ r ä¸€å®šæ˜¯ 1 å¹¶ä¸”å½“å‰å…ƒç´ æ˜¯é•¿åº¦ä¸º 1 çš„å­åºåˆ—å°¾å…ƒç´ ä¸­æœ€å°çš„
            mi[1] = a[i];
        }
    }

    cout << max_len << "\n";
}

signed main() {
    std::ios::sync_with_stdio(false);
    std::cin.tie(nullptr);
    int T = 1;
//    std::cin >> T;
    while (T--) solve();
    return 0;
}
```

### ç½‘æ ¼å›¾ dp

è¿‡æ²³å’

<https://www.luogu.com.cn/problem/P1002>

> æ ‡ç­¾ï¼šç½‘æ ¼å›¾ dpã€dfs
>
> é¢˜æ„ï¼šç»™å®šä¸€ä¸ªçŸ©é˜µï¼Œç°åœ¨éœ€è¦ä»å·¦ä¸Šè§’èµ°åˆ°å³ä¸‹è§’ï¼Œé—®ä¸€å…±æœ‰å¤šå°‘ç§èµ°æ³•ï¼Ÿæœ‰ä¸€ä¸ªç‰¹æ®Šé™åˆ¶æ˜¯ï¼Œå¯¹äºå›¾ä¸­çš„ 9 ä¸ªç‚¹æ˜¯æ— æ³•é€šè¿‡çš„ã€‚
>
> æ€è·¯ä¸€ï¼šdfs
>
> - æˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ·±æœçš„æ–¹æ³•ã€‚ä½†æ˜¯ä¼šè¶…æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä¼°ç®—æ—¶é—´å¤æ‚åº¦ï¼šå¯¹äºæ¯ä¸€ä¸ªç‚¹ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è®¡ç®—å½“å‰ç‚¹çš„å³ä¸‹è§’çš„çŸ©é˜µä¸­çš„æ¯ä¸€ä¸ªç‚¹ï¼Œé‚£ä¹ˆæ€»è¿ç®—æ¬¡æ•°å°±è¿‘ä¼¼ä¸ºé˜¶ä¹˜çº§åˆ«ã€‚å½“ç„¶å®é™…çš„æ—¶é—´å¤æ‚åº¦ä¸ä¼šè¿™ä¹ˆå¤§ï¼Œä½†æ˜¯è¿™ç§åšæ³• $n*m$ ä¸€æ—¦è¶…è¿‡ 100 å°±å¾ˆå®¹æ˜“ tle
>
> - æ—¶é—´å¤æ‚åº¦ï¼š$O(nm!)$
>
> æ€è·¯äºŒï¼šdp
>
> - æˆ‘ä»¬å¯ä»¥è€ƒè™‘ï¼Œå¯¹äºå½“å‰çš„ç‚¹ï¼Œå¯ä»¥ä»å“ªäº›ç‚¹èµ°è¿‡æ¥ï¼Œå¾ˆæ˜¾ç„¶å°±æ˜¯ä¸Šé¢ä¸€ä¸ªç‚¹å’Œå·¦è¾¹ä¸€ä¸ªç‚¹ï¼Œè€Œå¯¹äºèµ°åˆ°å½“å‰è¿™ä¸ªç‚¹çš„è·¯çº¿å°±æ˜¯èµ°åˆ°ä¸Šé¢çš„ç‚¹å’Œå·¦è¾¹çš„ç‚¹çš„è·¯çº¿ä¹‹å’Œï¼Œbase çŠ¶æ€å°±æ˜¯ `dp[1][1] = 1`ï¼Œå³èµ·ç‚¹çš„è·¯çº¿æ•°ä¸º 1
>
> - æ—¶é—´å¤æ‚åº¦ï¼š$O(nm)$

dfs ä»£ç 

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

const int N = 30;

int n, m, a, b;
int res;
bool notsafe[N][N];

void init() {
    int px[9] = {0, -1, -2, -2, -1, 1, 2, 2, 1};
    int py[9] = {0, 2, 1, -1, -2, -2, -1, 1, 2};
    for (int i = 0; i < 9; i++) {
        int na = a + px[i], nb = b + py[i];
        if (na < 0 || nb < 0) continue;
        notsafe[na][nb] = true;
    }
}

void dfs(int x, int y) {
    if (x > n || y > m || notsafe[x][y]) {
        return;
    }

    if (x == n && y == m) {
        res++;
        return;
    }

    dfs(x, y + 1);
    dfs(x + 1, y);
}

void solve() {
    cin >> n >> m >> a >> b;
    init();
    dfs(0, 0);
    cout << res << "\n";
}

signed main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

dp ä»£ç 

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

const int N = 30;

int n, m, a, b;
bool notsafe[N][N];
ll dp[N][N];

void solve() {
    cin >> n >> m >> a >> b;

    // åˆå§‹åŒ–
    ++n, ++m, ++a, ++b;
    int px[9] = {0, -1, -2, -2, -1, 1, 2, 2, 1};
    int py[9] = {0, 2, 1, -1, -2, -2, -1, 1, 2};
    for (int i = 0; i < 9; i++) {
        int na = a + px[i], nb = b + py[i];
        if (na < 0 || nb < 0) continue;
        notsafe[na][nb] = true;
    }

    // dpæ±‚è§£
    dp[1][1] = 1;
    for (int i = 1; i <= n; i++) {
        for (int j = 1; j <= m; j++) {
            if (!notsafe[i - 1][j]) dp[i][j] += dp[i - 1][j];
            if (!notsafe[i][j - 1]) dp[i][j] += dp[i][j - 1];
        }
    }

    cout << dp[n][m] << "\n";
}

signed main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

æ‘˜æ¨±æ¡ƒ II

<https://leetcode.cn/problems/cherry-pickup-ii/>

> é¢˜æ„ï¼šç»™å®šä¸€ä¸ª $n$ è¡Œ $m$ åˆ—çš„ç½‘æ ¼å›¾ï¼Œæ¯ä¸ªæ ¼å­æ‹¥æœ‰ä¸€ä¸ªä»·å€¼ã€‚ç°åœ¨æœ‰ä¸¤ä¸ªäººåˆ†åˆ«ä»å·¦ä¸Šè§’å’Œå³ä¸Šè§’å¼€å§‹ç§»åŠ¨ï¼Œç§»åŠ¨æ–¹å¼ä¸ºã€Œå·¦ä¸‹ã€ä¸‹ã€å³ä¸‹ã€ä¸‰ä¸ªæ–¹å‘ï¼Œé—®ä¸¤äººæœ€ç»ˆæœ€å¤šä¸€å…±å¯ä»¥è·å¾—å¤šå°‘ä»·å€¼ï¼Ÿå¦‚æœä¸¤äººåŒæ—¶ç»è¿‡ä¸€ä¸ªä½ç½®ï¼Œåˆ™åªèƒ½ç®—ä¸€æ¬¡ä»·å€¼ã€‚
>
> æ€è·¯ï¼š
>
> - çŠ¶æ€å®šä¹‰ã€‚æœ€ç»ˆçŠ¶æ€ä¸€å®šæ˜¯ä¸¤äººéƒ½åœ¨æœ€åä¸€è¡Œçš„ä»»æ„ä¸¤åˆ—ï¼Œæˆ‘ä»¬å¦‚ä½•å®šä¹‰çŠ¶æ€å¯ä»¥ä¸é‡ä¸æ¼çš„è¡¨ç¤ºä¸¤äººçš„è¿åŠ¨çŠ¶æ€å‘¢ï¼Ÿå¯ä»¥å‘ç°ä¸¤äººå§‹ç»ˆåœ¨åŒä¸€è¡Œï¼Œä½†æ˜¯åˆ—æ•°ä¸ä¸€å®šç›¸åŒï¼Œæˆ‘ä»¬å®šä¹‰çŠ¶æ€ $f[i][j][k]$ è¡¨ç¤ºä¸¤äººèµ°åˆ°ç¬¬ $i$ è¡Œæ—¶ï¼Œä¸€äººåœ¨ç¬¬ $j$ åˆ—ï¼Œå¦ä¸€äººåœ¨ç¬¬ $k$ åˆ—æ—¶çš„æ€»ä»·å€¼ã€‚åˆ™ç­”æ¡ˆå°±æ˜¯ï¼š
>
>     $$
>     \max{(f [n-1][j] [k])}, j, k\in [0, m]
>     $$
>
> - çŠ¶æ€è½¬ç§»ã€‚æœ¬é¢˜éš¾ç‚¹åœ¨äºçŠ¶æ€å®šä¹‰ï¼Œä¸€æ—¦å®šä¹‰å¥½äº†ä»¥åçŠ¶æ€è½¬ç§»å°±ä¸å›°éš¾äº†ã€‚å¯¹äºå½“å‰çŠ¶æ€ $f[i][j][k]$ï¼Œæ ¹æ®ä¹˜æ³•åŸç†ï¼Œä¸¤äººå‡æœ‰ 3 ç§èµ°æ³•ï¼Œå› æ­¤å½“å‰çŠ¶æ€å¯ä»¥ä» $3\times 3=9$ ç§åˆæ³•çŠ¶æ€è½¬ç§»è¿‡æ¥ã€‚å–æœ€å¤§å€¼å³å¯ã€‚
>
> æ—¶é—´å¤æ‚åº¦ï¼š$O(nm^2)$

```python
class Solution:
    def cherryPickup(self, g: List[List[int]]) -> int:
        n, m = len(g), len(g[0])
        f = [[[-1] * m for _ in range(m)] for _ in range(n)]
        f[0][0][m - 1] = g[0][0] + g[0][m - 1]
        for i in range(1, n):
            for j in range(m):
                for k in range(m):
                    # æšä¸¾ 9 ä¸ªå­é—®é¢˜
                    for p in range(j - 1, j + 2):
                        for q in range(k - 1, k + 2):
                            if 0 <= p < m and 0 <= q < m and f[i - 1][p][q] != -1:
                                f[i][j][k] = max(f[i][j][k], f[i - 1][p][q] + g[i][j] + (0 if j == k else g[i][k]))
        
        res = 0
        for j in range(m):
            for k in range(j, m):
                res = max(res, f[n - 1][j][k])
        
        return res
```

æ‘˜æ¨±æ¡ƒ

å¼±åŒ–ç‰ˆ $(n\le 50)$ ï¼š<https://leetcode.cn/problems/cherry-pickup/>

å¼ºåŒ–ç‰ˆ $(n\le300)$ ï¼š<https://codeforces.com/problemset/problem/213/C>

> é¢˜æ„ï¼šç»™å®šä¸€ä¸ª n è¡Œ n åˆ—çš„ç½‘æ ¼å›¾ï¼Œé—®ä»å·¦ä¸Šèµ°åˆ°å³ä¸‹ï¼Œå†ä»å³ä¸‹èµ°åˆ°å·¦ä¸Šæœ€å¤šå¯ä»¥è·å¾—å¤šå°‘ä»·å€¼ï¼Ÿä¸€ä¸ªå•å…ƒæ ¼åªèƒ½è¢«è®¡ç®—ä¸€æ¬¡ä»·å€¼ã€‚
>
> æ³¨ï¼šå¼±åŒ–ç‰ˆä¸­ -1 è¡¨ç¤ºä¸å¯è¾¾ï¼Œå¼ºåŒ–ç‰ˆæ²¡æœ‰ä¸å¯è¾¾çš„çº¦æŸã€‚[å¼ºåŒ–ç‰ˆ AC ä»£ç ](https://codeforces.com/contest/213/submission/278617557)
>
> æ€è·¯ä¸€ï¼šæš´åŠ› dp
>
> - é¦–å…ˆå¯¹äºæ¥å›é—®é¢˜å¯ä»¥è½¬åŒ–ä¸ºä¸¤æ¬¡å»çš„é—®é¢˜ï¼Œå³é—®é¢˜ç­‰ä»·äºæ±‚è§£ã€Œä¸¤ä¸ªäººä»å·¦ä¸Šè§’èµ°åˆ°å³ä¸‹è§’ã€çš„æœ€å¤§æ”¶ç›Šã€‚
> - æ˜¾ç„¶æˆ‘ä»¬å¯ä»¥å®šä¹‰å››ç»´çš„çŠ¶æ€ï¼Œå…¶ä¸­ $f[i][j][p][q]$ è¡¨ç¤ºç¬¬ä¸€ä¸ªäººèµ°åˆ° $(i,j)$ ä¸”ç¬¬äºŒä¸ªäººèµ°åˆ° $(p,q)$ æ—¶çš„æœ€å¤§æ”¶ç›Šã€‚ç›´æ¥æšä¸¾è¿™å››ä¸ªç»´åº¦ï¼Œç„¶åä» 4 ä¸ªåˆæ³•çš„å­é—®é¢˜è½¬ç§»è¿‡æ¥å³å¯ã€‚
> - æ—¶é—´å¤æ‚åº¦ï¼š$O(n^4)$
>
> æ€è·¯äºŒï¼šä¼˜åŒ– dp
>
> - æ³¨æ„åˆ°é—®é¢˜å¯ä»¥è¿›ä¸€æ­¥ç­‰ä»·äºã€Œä¸¤ä¸ªäºº **åŒæ—¶** ä»å·¦ä¸Šè§’èµ°åˆ°å³ä¸‹è§’ã€çš„æœ€å¤§æ”¶ç›Šã€‚ä¹Ÿå°±æ˜¯ä¸¤ä¸ªäººåˆ°èµ·ç‚¹ $(0,0)$ çš„æ›¼å“ˆé¡¿è·ç¦»åº”è¯¥æ˜¯ä¸€æ ·çš„ï¼Œå³ $i+j=p+q$ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå…¶ä¸­ä¸€ä¸ªäºº $(i,j)$ çš„ä½ç½®ç¡®å®šäº†ï¼Œåˆ™å¦ä¸€ä¸ªäººåªéœ€è¦æšä¸¾ä¸€ä¸ªä¸‹æ ‡ï¼Œå¦ä¸€ä¸ªä¸‹æ ‡å°±å¯ä»¥ $O(1)$ çš„ç¡®å®šäº†ã€‚å¯ä»¥å°†æ—¶é—´å¤æ‚åº¦é™ä½ä¸€ä¸ªç»´åº¦ã€‚
> - çŠ¶æ€å®šä¹‰ã€‚æˆ‘ä»¬å®šä¹‰ $f[k][i_1][i_2]$ è¡¨ç¤ºç¬¬ä¸€ä¸ªäººèµ°åˆ° $(i_1,k-i_1)$ ä¸”ç¬¬äºŒä¸ªäººèµ°åˆ° $(i_2,k-i_2)$ æ—¶çš„æœ€å¤§æ”¶ç›Šã€‚åˆ™æœ€ç»ˆç­”æ¡ˆå°±æ˜¯ $f[2n-2][n-1][n-1]$ã€‚çŠ¶æ€è½¬ç§»åŒç†ï¼Œä» 4 ä¸ªåˆæ³•å­é—®é¢˜è½¬ç§»è¿‡æ¥å³å¯ã€‚
> - æ—¶é—´å¤æ‚åº¦ï¼š$O(n^3)$

æš´åŠ› dpï¼š

```cpp
template<class T>
void chmax(T& a, T b) {
    a = max(a, b);
}

int di[4] = {-1, -1, 0, 0};
int dj[4] = {0, 0, -1, -1};
int dp[4] = {-1, 0, -1, 0};
int dq[4] = {0, -1, 0, -1};

class Solution {
public:
    int cherryPickup(vector<vector<int>>& g) {
        int n = g.size();
        int f[n][n][n][n];
        memset(f, -1, sizeof f);
        f[0][0][0][0] = g[0][0] == -1 ? -1 : g[0][0];
        for (int i = 0; i < n; i++) {
            for (int j = 0; j < n; j++) {
                if (g[i][j] == -1) {
                    continue;
                }
                for (int p = 0; p < n; p++) {
                    for (int q = 0; q < n; q++) {
                        if (g[p][q] == -1) {
                            continue;
                        }
                        // æšä¸¾ 4 ä¸ªå­é—®é¢˜
                        for (int k = 0; k < 4; k++) {
                            int ni = i + di[k], nj = j + dj[k];
                            int np = p + dp[k], nq = q + dq[k];
                            if (ni >= 0 && nj >= 0 && np >= 0 && nq >= 0 && f[ni][nj][np][nq] != -1) {
                                chmax(f[i][j][p][q], f[ni][nj][np][nq] + g[i][j] + (i == p && j == q ? 0 : g[p][q]));
                            }
                        }
                    }
                }
            }
        }
        return f[n - 1][n - 1][n - 1][n - 1] == -1 ? 0 : f[n - 1][n - 1][n - 1][n - 1];
    }
};
```

ä¼˜åŒ– dpï¼š

```cpp
template<class T>
void chmax(T& a, T b) {
    a = max(a, b);
}

int dx[] = {0, 0, -1, -1};
int dy[] = {0, -1, 0, -1};

class Solution {
public:
    int cherryPickup(vector<vector<int>>& g) {
        int n = g.size();
        int f[2 * n - 1][n][n];
        memset(f, -1, sizeof f);
        f[0][0][0] = g[0][0] == -1 ? -1 : g[0][0];
        for (int k = 1; k <= 2 * n - 2; k++) {
            for (int i1 = 0; i1 < n; i1++) {
                for (int i2 = 0; i2 < n; i2++) {
                    int j1 = k - i1, j2 = k - i2;
                    if (j1 < 0 || j1 >= n || j2 < 0 || j2 >= n || g[i1][j1] == -1 || g[i2][j2] == -1) {
                        continue;
                    }
                    // æšä¸¾ 4 ä¸ªå­é—®é¢˜
                    for (int t = 0; t < 4; t++) {
                        int ni1 = i1 + dx[t], nj1 = k - ni1;
                        int ni2 = i2 + dy[t], nj2 = k - ni2;
                        if (ni1 >= 0 && nj1 >= 0 && ni2 >= 0 && nj2 >= 0 && f[k - 1][ni1][ni2] != -1) {
                            chmax(f[k][i1][i2], f[k - 1][ni1][ni2] + g[i1][j1] + (i1 == i2 && j1 == j2 ? 0 : g[i2][j2]));
                        }
                    }
                }
            }
        }
        return f[2 * n - 2][n - 1][n - 1] == -1 ? 0 : f[2 * n - 2][n - 1][n - 1];
    }
};
```

### æ ‘å½¢ dp

æ ‘çš„è·¯å¾„é—®é¢˜ï¼Œè€ƒè™‘å›æº¯ã€‚å¦‚ä½•æ›´æ–°å€¼ï¼Ÿå¦‚ä½•è¿”å›å€¼ï¼Ÿè§†é¢‘å­¦ä¹ ï¼š<https://www.bilibili.com/video/BV17o4y187h1/>ã€‚

æœ€å¤§ç¤¾äº¤æ·±åº¦å’Œ

<https://vijos.org/d/nnu_contest/p/1534>

> ç®—æ³•ï¼šæ ‘å½¢ dpã€BFS
>
> é¢˜æ„ï¼šç»™å®šä¸€æ£µæ ‘ï¼Œç°åœ¨éœ€è¦é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªç»“ç‚¹ä¸ºæ ¹èŠ‚ç‚¹ï¼Œä½¿å¾—æ·±åº¦å’Œæœ€å¤§ã€‚æ·±åº¦çš„å®šä¹‰æ˜¯ä»¥æ¯ä¸ªç»“ç‚¹åˆ°æ ‘æ ¹æ‰€ç»å†çš„ç»“ç‚¹æ•°
>
> æ€è·¯ä¸€ï¼šæš´åŠ›
>
> - æ˜¾ç„¶å¯ä»¥ç›´æ¥éå†æ¯ä¸€ä¸ªç»“ç‚¹ï¼Œè®¡ç®—æ¯ä¸ªç»“ç‚¹çš„æ·±åº¦å’Œï¼Œç„¶åå–æœ€å¤§å€¼å³å¯
>
> - æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$
>
> æ€è·¯äºŒï¼šæ ‘å½¢ dp
>
> ![æ ‘å½¢ dp å›¾è§£](https://cdn.dwj601.cn/images/202403182214257.png)
>
> - æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¯¹äºå½“å‰çš„æ ¹ç»“ç‚¹ `fa`ï¼Œæˆ‘ä»¬é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªå­ç»“ç‚¹ `ch`ï¼Œå°† `ch` ä½œä¸ºæ–°çš„æ ¹ç»“ç‚¹ï¼ˆå¦‚å³å›¾ï¼‰ã€‚é‚£ä¹ˆå¯¹äºå½“å‰çš„ `ch` çš„æ·±åº¦å’Œï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© `fa` çš„æ·±åº¦å’Œè¿›è¡Œæ±‚è§£ã€‚æˆ‘ä»¬å‡è®¾ä»¥ `ch` ä¸ºå­æ ‘çš„ç»“ç‚¹æ€»æ•°ä¸º `x`ï¼Œé‚£ä¹ˆè¿™ `x` ä¸ªç»“ç‚¹åœ¨æ¢æ ¹ä¹‹åï¼Œç›¸å¯¹äº `ch` çš„æ·±åº¦å’Œï¼Œè´¡çŒ®äº† `-x` çš„æ·±åº¦ï¼›è€Œå¯¹äº `fa` çš„å‰©ä¸‹æ¥çš„ `n-x` ä¸ªç»“ç‚¹ï¼Œç›¸å¯¹äº `ch` çš„æ·±åº¦å’Œï¼Œè´¡çŒ®äº† `n-x` çš„æ·±åº¦ã€‚äºæ˜¯ `ch` çš„æ·±åº¦å’Œå°±æ˜¯ `façš„æ·±åº¦å’Œ` `-x+n-x`ï¼Œå³ï¼š
>
>     $$
>     dep [ch] = dep [fa]-x+n-x = dep [fa]+n-2\times x
>     $$
>
>     äºæ˜¯æˆ‘ä»¬å¾ˆå¿«å°±èƒ½æƒ³åˆ°åˆ©ç”¨å‰åå±‚çš„é€’æ¨å…³ç³»ï¼Œ$O(1)$ çš„è®¡ç®—å‡ºæ‰€æœ‰å­ç»“ç‚¹çš„æ·±åº¦å’Œã€‚
>
>     ä»£ç å®ç°ï¼šæˆ‘ä»¬å¯ä»¥å…ˆè®¡ç®—å‡º `base` çš„æƒ…å†µï¼Œå³ä»»é€‰ä¸€ä¸ªç»“ç‚¹ä½œä¸ºæ ¹ç»“ç‚¹ï¼Œç„¶ååŸºäºæ­¤è¿›è¡Œè¿­ä»£è®¡ç®—ã€‚åœ¨è¿­ä»£è®¡ç®—çš„æ—¶å€™éœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯åœ¨ä¸€é `dfs` è®¡ç®—æŸä¸ªç»“ç‚¹çš„æ·±åº¦å’Œ `dep[root]` æ—¶ï¼Œå¦‚æœå¸Œæœ›åŒæ—¶è®¡ç®—å‡ºæ¯ä¸€ä¸ªç»“ç‚¹ä½œä¸ºå­æ ‘æ—¶ï¼Œå­æ ‘çš„ç»“ç‚¹æ•°ï¼Œæ˜¾ç„¶éœ€è¦åˆ†æ²»è®¡ç®—ä¸€æ³¢ã€‚å…³äºåˆ†æ²»çš„è®¡ç®—æˆ‘ç†Ÿç»ƒåº¦ä¸å¤Ÿé«˜ï¼Œ~~ç‰¹æ­¤æ ‡æ³¨ä¸€ä¸‹ debug äº† 3h çš„ç‚¹~~ï¼šå³åœ¨é€’å½’åˆ°æœ€åº•å±‚ï¼Œè¿›è¡Œå›æº¯è®¡ç®—çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä¸èƒ½ç»Ÿè®¡çˆ¶ç»“ç‚¹çš„ç»“ç‚¹å€¼ï¼ˆå› ä¸ºå»ºçš„æ˜¯åŒå‘å›¾ï¼Œæ‰€ä»¥ä¸€å®šä¼šæœ‰ä»çˆ¶ç»“ç‚¹å›æº¯çš„æƒ…å†µï¼‰ï¼Œé‚£ä¹ˆä¸ºäº†é¿å¼€è¿™ä¸ªç‚¹ï¼Œå°±éœ€è¦åœ¨ $O(1)$ çš„æ—¶é—´å¤æ‚åº¦å†…è·å¾—å½“å‰ç»“ç‚¹çš„çˆ¶ç»“ç‚¹çš„ç¼–å·ï¼Œä»è€Œè¿›è¡Œç‰¹åˆ¤ï¼Œé‡‡ç”¨çš„æ–¹å¼å°±æ˜¯å¢åŠ é€’å½’å‚æ•° `fa`ã€‚
>
> - æ²¡æœ‰è€ƒè™‘ä»çˆ¶ç»“ç‚¹å›æº¯çš„æƒ…å†µçš„ dfs ä»£ç 
>
>     ```cpp
>     void dfs(int now, int depth) {
>         if (!st[now]) {
>             st[now] = true;
>             dep[root] += depth;
>             for (auto& ch: G[now]) {
>                 dfs(ch, depth + 1);
>                 cnt[now] += cnt[ch];
>             }
>         }
>     }
>     ```
>
> - è€ƒè™‘äº†ä»çˆ¶ç»“ç‚¹å›æº¯çš„æƒ…å†µçš„ dfs ä»£ç 
>
>     ```cpp
>     void dfs(int now, int fa, int depth) {
>         if (!st[now]) {
>             st[now] = true;
>             dep[root] += depth;
>             for (auto& ch: G[now]) {
>                 dfs(ch, now, depth + 1);
>                 if (ch != fa) {
>                     cnt[now] += cnt[ch];
>                 }
>             }
>         }
>     }
>     ```
>
> - æ—¶é—´å¤æ‚åº¦ï¼š$\Theta(2n)$

æš´åŠ›ä»£ç ï¼š

```cpp
const int N = 500010;

int n;
vector<int> G[N];
int st[N], dep[N];

void dfs(int id, int now, int depth) {
    if (!st[now]) {
        st[now] = 1;
        dep[id] += depth;
        for (auto& node: G[now]) {
            dfs(id, node, depth + 1);
        }
    }
}

void solve() {
    cin >> n;
    for (int i = 1; i <= n - 1; i++) {
        int a, b;
        cin >> a >> b;
        G[a].push_back(b);
        G[b].push_back(a);
    }

    int res = 0;

    for (int i = 1; i <= n; i++) {
        memset(st, 0, sizeof st);
        dfs(i, i, 1);
        res = max(res, dep[i]);
    }

    cout << res << "\n";
}
```

ä¼˜åŒ–ä»£ç ï¼š

```cpp
const int N = 500010;

int n, dep[N], root = 1;
vector<int> G[N], cnt(N, 1);;
bool st[N];

// å½“å‰ç»“ç‚¹ç¼–å· nowï¼Œå½“å‰ç»“ç‚¹çš„çˆ¶ç»“ç‚¹ faï¼Œå½“å‰ç»“ç‚¹æ·±åº¦ depth
void dfs(int now, int fa, int depth) {
    if (!st[now]) {
        st[now] = true;
        dep[root] += depth;
        for (auto& ch: G[now]) {
            dfs(ch, now, depth + 1);
            if (ch != fa) {
                cnt[now] += cnt[ch];
            }
        }
    }
}

void bfs() {
    memset(st, 0, sizeof st);
    queue<int> q;
    q.push(root);
    st[root] = true;

    while (q.size()) {
        int fa = q.front(); // çˆ¶ç»“ç‚¹ç¼–å· fa
        q.pop();
        for (auto& ch: G[fa]) {
            if (!st[ch]) {
                st[ch] = true;
                dep[ch] = dep[fa] + n - 2 * cnt[ch];
                q.push(ch);
            }
        }
    }
}

void solve() {
    cin >> n;
    for (int i = 1; i <= n - 1; i++) {
        int a, b;
        cin >> a >> b;
        G[a].push_back(b);
        G[b].push_back(a);
    }

    dfs(root, -1, 1);
    bfs();

    cout << *max_element(dep, dep + n + 1) << "\n";
}
```

### é«˜ç»´ dp

æ ˆ

<https://www.luogu.com.cn/problem/P1044>

> é¢˜æ„ï¼šn ä¸ªæ•°ä¾æ¬¡è¿›æ ˆï¼Œéšæœºå‡ºæ ˆï¼Œé—®ä¸€å…±æœ‰å¤šå°‘ç§å‡ºæ ˆåºåˆ—ï¼Ÿ
>
> **æ€è·¯ä¸€ï¼šdfs**
>
> - æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæ„é€ æœç´¢æ ‘ï¼šå·²çŸ¥å¯¹äºå½“å‰çš„æ ˆï¼Œä¸€å…±æœ‰ä¸¤ç§çŠ¶æ€
>     - å…¥æ ˆ - å¦‚æœå½“å‰è¿˜æœ‰æ•°æ²¡æœ‰å…¥æ ˆ
>     - å‡ºæ ˆ - å¦‚æœå½“å‰æ ˆå†…è¿˜æœ‰å…ƒç´ 
> - æœç´¢å‚æ•°ï¼š`i,j` è¡¨ç¤ºå…¥æ ˆæ•°ä¸º `i` å‡ºæ ˆæ•°ä¸º `j` çš„çŠ¶æ€
> - æœç´¢ç»ˆæ­¢æ¡ä»¶
>     - å…¥æ ˆæ•° < å‡ºæ ˆæ•° - $i<j$
>     - å…¥æ ˆæ•° > æ€»æ•° $n$ - $i = n$
> - ç­”æ¡ˆçŠ¶æ€ï¼šå…¥æ ˆæ•°ä¸º nï¼Œå‡ºæ ˆæ•°ä¹Ÿä¸º n
> - æ—¶é—´å¤æ‚åº¦ï¼š$O(\text{æ–¹æ¡ˆæ•°})$
>
> **æ€è·¯äºŒï¼šdp**
>
> - é‡‡ç”¨ä¸Šè¿° dfs æ—¶çš„çŠ¶æ€è¡¨ç¤ºæ–¹æ³•ï¼Œ`i,j` è¡¨ç¤ºå…¥æ ˆæ•°ä¸º `i` å‡ºæ ˆæ•°ä¸º `j` çš„çŠ¶æ€ã€‚
>
> - æˆ‘ä»¬åœ¨æœç´¢çš„æ—¶å€™ï¼Œè€ƒè™‘çš„æ˜¯æ¥ä¸‹æ¥å¯ä»¥æœç´¢çš„çŠ¶æ€
>
>     1. å³å‡ºæ ˆä¸€ä¸ªæ•°çš„çŠ¶æ€ - `i+1,j`
>
>     2. å’Œå…¥æ ˆä¸€ä¸ªæ•°çš„çŠ¶æ€ - `i,j+1`
>
>     å¦‚å›¾ï¼š
>
>     ![å›¾è§£](https://cdn.dwj601.cn/images/202403182214793.png)
>
>     è€Œæˆ‘ä»¬åœ¨ dp çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘çš„æ˜¯å­ç»“æ„çš„è§£æ¥å¾—å‡ºå½“å‰çŠ¶æ€çš„ç­”æ¡ˆï¼Œå°±éœ€è¦è€ƒè™‘ä¹‹å‰çš„çŠ¶æ€ã€‚å³å½“å‰çŠ¶æ€æ˜¯ä»ä¹‹å‰çš„å“ªäº›çŠ¶æ€è½¬ç§»è¿‡æ¥çš„ã€‚å’Œä¸Šè¿° dfs æ€è·¯æ˜¯ç›¸åçš„ã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„æ˜¯
>
>     1. ä¸Šä¸€ä¸ªçŠ¶æ€å…¥æ ˆä¸€ä¸ªæ•°åˆ°å½“å‰çŠ¶æ€ - `i-1,j` $\to$ `i,j`
>     2. ä¸Šä¸€ä¸ªçŠ¶æ€å‡ºæ ˆä¸€ä¸ªæ•°åˆ°å½“å‰çŠ¶æ€ - `i,j-1` $\to$ `i,j`
>
>     - ç‰¹ä¾‹ï¼š$i=j$ æ—¶ï¼Œåªèƒ½æ˜¯ä¸Šè¿°ç¬¬äºŒç§çŠ¶æ€è½¬ç§»è€Œæ¥ï¼Œå› ä¸ºè¦å§‹ç»ˆä¿è¯å…¥æ ˆæ•°å¤§äºç­‰äºå‡ºæ ˆæ•°ï¼Œå³ $i \ge j$
>
>     å¦‚å›¾ï¼š
>
>     ![å›¾è§£](https://cdn.dwj601.cn/images/202403191805594.png)
>
> - æˆ‘ä»¬çŸ¥é“ï¼Œå…¥æ ˆæ•°ä¸€å®šæ˜¯å¤§äºç­‰äºå‡ºæ ˆæ•°çš„ï¼Œå³ $i\ge j$ã€‚äºæ˜¯æˆ‘ä»¬åœ¨æšä¸¾ $j$ çš„æ—¶å€™ï¼Œæšä¸¾çš„èŒƒå›´æ˜¯ $[1,i]$
>
> - $base$ çŠ¶æ€çš„æ„å»ºå–å†³äº $j=0$ æ—¶çš„æ‰€æœ‰çŠ¶æ€ï¼Œæˆ‘ä»¬çŸ¥é“æ²¡æœ‰ä»»ä½•æ•°å‡ºæ ˆä¹Ÿæ˜¯ä¸€ç§çŠ¶æ€ï¼Œäºæ˜¯
> 
>     $$
>     dp [i][0] = 0,(i = 1,2,3,..., n)
>     $$
>
> - æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$

dfs ä»£ç 

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

int n, res;

// å…¥æ ˆiä¸ªæ•°ï¼Œå‡ºæ ˆjä¸ªæ•°
void dfs(int i, int j) {
    if (i < j || i > n) return;

    if (i == n && j == n) res++;

    dfs(i + 1, j);
    dfs(i, j + 1);
}

void solve() {
    cin >> n;
    dfs(0, 0);
    cout << res << "\n";
}

signed main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

dp ä»£ç 

```cpp
#include <bits/stdc++.h>
using namespace std;
typedef long long ll;

const int N = 20;

int n;
ll dp[N][N]; // dp[i][j] è¡¨ç¤ºå…¥æ ˆæ•°ä¸ºiï¼Œå‡ºæ ˆæ•°ä¸ºjçš„æ–¹æ¡ˆæ€»æ•°

void solve() {
    cin >> n;

    // baseçŠ¶æ€ï¼šæ²¡æœ‰æ•°å‡ºæ ˆä¹Ÿæ˜¯ä¸€ç§çŠ¶æ€
    for (int i = 1; i <= n; i++) dp[i][0] = 1;

    // dpè½¬ç§»
    for (int i = 1; i <= n; i++)
        for (int j = 1; j <= i; j++)
            if (i == j) dp[i][j] = dp[i][j - 1];
            else dp[i][j] = dp[i - 1][j] + dp[i][j - 1];

    cout << dp[n][n] << "\n";
}

signed main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

æ‰¾å‡ºæ‰€æœ‰ç¨³å®šçš„äºŒè¿›åˆ¶æ•°ç»„ II

<https://leetcode.cn/problems/find-all-possible-stable-binary-arrays-ii/>

> é¢˜æ„ï¼šæ„é€ ä¸€ä¸ªä»…å«æœ‰ $n$ ä¸ª $0$ï¼Œ$m$ ä¸ª $1$ çš„æ•°ç»„ï¼Œä¸”é•¿åº¦è¶…è¿‡ $k$ çš„å­æ•°ç»„å¿…é¡»åŒæ—¶å«æœ‰ $0$ å’Œ $1$ã€‚ç»™å‡ºæ„é€ çš„æ€»æ–¹æ¡ˆæ•°å¯¹ $10^9+7$ å–ä½™åçš„ç»“æœã€‚
>
> æ€è·¯ï¼š
>
> - å®šä¹‰çŠ¶æ€è¡¨ã€‚æˆ‘ä»¬ä»å·¦åˆ°å³ç¡®å®šæ¯ä¸€ä½çš„æ•°å­—æ—¶ï¼Œéœ€è¦ç¡®å®šè¿™ä¹ˆä¸‰ä¸ªä¿¡æ¯ï¼šå½“å‰æ˜¯å“ªä¸€ä½ï¼Ÿè¿˜å‰©å‡ ä¸ª $0$ å’Œ $1$ï¼Ÿè¿™ä¸€ä½å¡« $0$ è¿˜æ˜¯ $1$ï¼Ÿå¯¹äºè¿™ä¸‰ä¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰çŠ¶æ€æ•°ç»„ $f[i][j][k]$ è¡¨ç¤ºå½“å‰å·²ç»é€‰äº† $i$ ä¸ª $0$ï¼Œ$j$ ä¸ª $1$ï¼Œä¸”ç¬¬ $i+j$ ä½å¡« $k$ æ—¶çš„æ–¹æ¡ˆæ•°ã€‚è¿™æ ·æœ€ç»ˆç­”æ¡ˆå°±æ˜¯ $f[n][m][0]+f[n][m][1]$ã€‚
>
> - å®šä¹‰å­é—®é¢˜ã€‚ä»¥å½“å‰ç¬¬ $i+j$ ä½å¡« $0$ ä¸ºä¾‹ï¼Œå¡« $1$ åŒç†ï¼Œå³å½“å‰éœ€è¦ç»´æŠ¤çš„æ˜¯ $f[i][j][0]$ã€‚æ˜¾ç„¶çš„å¦‚æœå‰ä¸€ä½æ˜¯å’Œå½“å‰ä½ä¸åŒï¼Œå³ $1$ æ—¶ï¼Œå¯ä»¥ç›´æ¥è½¬ç§»è¿‡æ¥ï¼›å¦‚æœå‰ä¸€ä½å’Œå½“å‰ä½ç›¸åŒï¼Œå³ $0$ æ—¶ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°é•¿åº¦è¶…è¿‡ $k$ çš„è¿ç»­ $0$ å­æ•°ç»„ï¼Œå³å‰æ®µæ•°ç»„åˆšå¥½æ˜¯ä»¥ã€Œä¸€ä¸ª $1$ å’Œ $k$ ä¸ª $0$ ç»“å°¾çš„ã€åˆæ³•æ•°ç»„ï¼Œæ­¤æ—¶å†æ‹¼æ¥ä¸€ä¸ª $0$ å°±ä¸åˆæ³•äº†ã€‚
>
> - çŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¸¤ä¸ªçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š
>
>     $$
>     \begin{aligned}
>     f [i][j] [0] = f [i - 1][j] [1] + f [i - 1][j] [0] - f [i - k - 1][j] [1] \\
>     f [i][j] [1] = f [i][j - 1] [0] + f [i][j - 1] [1] - f [i][j - k - 1] [0]
>     \end{aligned}
>     $$
>
> æ—¶é—´å¤æ‚åº¦ï¼š$O(nm)$

```cpp
class Solution {
public:
    int numberOfStableArrays(int n, int m, int k) {
        const int mod = 1e9 + 7;
        vector<vector<array<int, 2>>> f(n + 1, vector<array<int, 2>>(m + 1));

        for (int i = 0; i <= min(n, k); i++) {
            f[i][0][0] = 1;
        }
        for (int j = 0; j <= min(m, k); j++) {
            f[0][j][1] = 1;
        }

        for (int i = 1; i <= n; i++) {
            for (int j = 1; j <= m; j++) {
                f[i][j][0] = (f[i - 1][j][1] + f[i - 1][j][0]) % mod;
                if (i - k - 1 >= 0) {
                    f[i][j][0] = (f[i][j][0] - f[i - k - 1][j][1] + mod) % mod;
                }
                f[i][j][1] = (f[i][j - 1][0] + f[i][j - 1][1]) % mod;
                if (j - k - 1 >= 0) {
                    f[i][j][1] = (f[i][j][1] - f[i][j - k - 1][0] + mod) % mod;
                }
            }
        }

        return (f[n][m][0] + f[n][m][1]) % mod;
    }
};
```

å­¦ç”Ÿå‡ºå‹¤è®°å½• II

<https://leetcode.cn/problems/student-attendance-record-ii/description/>

> é¢˜æ„ï¼šæ„é€ ä¸€ä¸ªä»…å«æœ‰ $P,A,L$ ä¸‰ç§å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œä½¿å¾— $A$ æœ€å¤šå‡ºç° $1$ æ¬¡ï¼ŒåŒæ—¶ $L$ æœ€å¤šè¿ç»­å‡ºç° $2$ æ¬¡ã€‚é—®ä¸€å…±æœ‰å¤šå°‘ç§æ„é€ æ–¹æ¡ˆï¼Ÿå¯¹ $10^9+7$ å–æ¨¡ã€‚
>
> æ€è·¯ï¼š
>
> - æ¨¡æ‹Ÿåˆ†æé—®é¢˜ã€‚æˆ‘ä»¬ä»å‰å¾€åæ„é€ ã€‚å¯¹äºå½“å‰ç¬¬ $i$ ä¸ªå­—ç¬¦ $s[i]$ï¼Œæœ‰ $3$ ç§å¯èƒ½çš„é€‰é¡¹ï¼Œå…¶ä¸­ $P$ æ˜¯ä¸€å®šåˆæ³•çš„é€‰é¡¹ï¼Œ$A$ æ˜¯å¦åˆæ³•å–å†³äº $s[0:i-1]$ ä¸­çš„ $A$ çš„æ•°é‡ï¼Œ$L$ æ˜¯å¦åˆæ³•å–å†³äº $s[0:i-1]$ çš„æœ«å°¾è¿ç»­ $L$ çš„æ•°é‡ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ **è¢«åŠ¨è½¬ç§»** çš„åŠ¨æ€è§„åˆ’æ±‚è§£ã€‚
> - çŠ¶æ€å®šä¹‰ã€‚ä»ä¸Šè¿°åˆ†æä¸éš¾å‘ç°éœ€è¦ $3$ ç§çŠ¶æ€æ¥è¡¨ç¤ºæ‰€æœ‰æƒ…å†µï¼Œå› æ­¤æˆ‘ä»¬å®šä¹‰ $f[i][j][k]$ è¡¨ç¤ºæ„é€ ç¬¬ $i$ ä½æ—¶ï¼Œ$s[0:i]$ ä¸­å«æœ‰ $j$ ä¸ª $A$ ä¸”æœ«å°¾å«æœ‰è¿ç»­ $k$ ä¸ª $L$ æ—¶çš„æ–¹æ¡ˆæ•°ã€‚
> - åˆå§‹åŒ–ã€‚æ¯ä¸€ä½å¡«ä»€ä¹ˆå–å†³äºå‰ç¼€ $s[0:i-1]$ çš„æƒ…å†µï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆå§‹åŒ– $f[0][][]$ å³ç¬¬ $0$ ä½çš„æƒ…å†µã€‚æ˜¾ç„¶çš„ç¬¬ $0$ ä½ $P,A,L$ ä¸‰ç§éƒ½å¯ä»¥å¡«ï¼Œå¯¹åº”çš„å°±æ˜¯ $f[0][0][0] = f[0][1][0] = f[0][0][1] = 1$ï¼Œå…¶ä½™åˆå§‹åŒ–ä¸º $0$ å³å¯ã€‚
> - çŠ¶æ€è½¬ç§»ã€‚è€ƒè™‘ç¬¬ $i$ ä½çš„ä¸‰ç§æƒ…å†µï¼š
>     1. å¡« $P$ï¼šå¯ä»¥ç”¨å‰ç¼€çš„æ‰€æœ‰çŠ¶æ€æ¥æ›´æ–° $f[i][j][0]$
>     2. å¡« $A$ï¼šå¯ä»¥ç”¨å‰ç¼€ä¸­ä¸å« $A$ çš„æ‰€æœ‰çŠ¶æ€æ¥æ›´æ–° $f[i][1][0]$
>     3. å¡« $L$ï¼šå¯ä»¥ç”¨å‰ç¼€ä¸­æœ«å°¾ä¸è¶…è¿‡ $1$ ä½ $L$ çš„æ‰€æœ‰çŠ¶æ€æ¥æ›´æ–° $f[i][j][k]$
> - æœ€ç»ˆç­”æ¡ˆã€‚ä¸º $\displaystyle \sum_{j=0}^{1}\sum_{k=0}^{2}f[n-1][j][k]$ã€‚
>
> æ—¶é—´å¤æ‚åº¦ï¼š$\Theta (6n)$

```cpp
class Solution {
public:
    int checkRecord(int n) {
        const int mod = 1e9 + 7;

        // f[i][j][k]è¡¨ç¤ºä»å·¦å¾€å³æ„é€ ç¬¬iä½æ—¶ï¼Œs[0:i]ä¸­å«æœ‰jä¸ªAä¸”å°¾éƒ¨å«æœ‰è¿ç»­kä¸ªLæ—¶çš„æ–¹æ¡ˆæ•°
        int f[n][2][3];
        memset(f, 0, sizeof f);

        // åˆå§‹åŒ–
        f[0][0][0] = f[0][1][0] = f[0][0][1] = 1;

        // è½¬ç§»
        for (int i = 1; i < n; i++) {
            // s[i]å¡«P
            for (int j = 0; j <= 1; j++) {
                for (int k = 0; k <= 2; k++) {
                    f[i][j][0] = (f[i][j][0] + f[i - 1][j][k]) % mod;
                }
            }
            // s[i]å¡«A
            for (int k = 0; k <= 2; k++) {
                f[i][1][0] = (f[i][1][0] + f[i - 1][0][k]) % mod;
            }
            // s[i]å¡«L
            for (int j = 0; j <= 1; j++) {
                for (int k = 1; k <= 2; k++) {
                    f[i][j][k] = (f[i][j][k] + f[i - 1][j][k - 1]) % mod;
                }
            }
        }

        // è®¡ç®—ç­”æ¡ˆ
        int res = 0;
        for (int j = 0; j <= 1; j++) {
            for (int k = 0; k <= 2; k++) {
                res = (res + f[n - 1][j][k]) % mod;
            }
        }
        return res;
    }
};
```

```python
class Solution:
    def checkRecord(self, n: int) -> int:
        mod = int(1e9 + 7)
        f = [[[0, 0, 0] for _ in range(2)] for _ in range(n)]
        f[0][0][0] = f[0][1][0] = f[0][0][1] = 1
        for i in range(1, n):
            # P
            for j in range(2):
                for k in range(3):
                    f[i][j][0] = (f[i][j][0] + f[i - 1][j][k]) % mod
            # A
            for k in range(3):
                f[i][1][0] = (f[i][1][0] + f[i - 1][0][k]) % mod
            # L
            for j in range(2):
                for k in range(1, 3):
                    f[i][j][k] = (f[i][j][k] + f[i - 1][j][k - 1]) % mod
        res = 0
        for j in range(2):
            for k in range(3):
                res = (res + f[n - 1][j][k]) % mod
        return res
```

### åŒºé—´ dp

å¯¹ç§°å±±è„‰

<https://www.acwing.com/problem/content/5169/>

æ¨¡æ‹Ÿï¼Œæ—¶é—´å¤æ‚åº¦ $O(n^3)$

```cpp
#include <iostream>
#include <cmath>

using namespace std;

const int N = 5010;

int n;
int a[N];

int main() {
    cin >> n;
    
    for (int i = 1; i <= n; i++)
        cin >> a[i];
    
    // æšä¸¾åŒºé—´é•¿åº¦
    for (int len = 1; len <= n; len++) {
        int res = 2e9;
        // æšä¸¾ç›¸åº”é•¿åº¦çš„æ‰€æœ‰åŒºé—´
        for (int i = 1, j = i + len - 1; j <= n; i++, j++) {
            // è®¡ç®—åŒºé—´çš„ä¸å¯¹ç§°å€¼
            int l = i, r = j;
            int sum = 0;
            while (l < r) {
                sum += abs(a[l] - a[r]);
                l++, r--;
            }
            res = min(res, sum);
        }
        cout << res << ' ';
    }
    
    return 0;
}
```

dp ä¼˜åŒ–ï¼Œæ—¶é—´å¤æ‚åº¦ $O(n^2)$

```cpp
#include <iostream>
#include <cmath>
#include <cstring>

using namespace std;

const int N = 5010;

int n;
int a[N];

int dp[N][N]; // dp[i][j] è¡¨ç¤ºç¬¬ i åˆ° j çš„ä¸å¯¹ç§°å€¼
int res[N];   // res[len] è¡¨ç¤ºé•¿åº¦ä¸º len çš„å±±è„‰çš„æœ€å°ä¸å¯¹ç§°å€¼ 

int main() {
    cin >> n;
    
    for (int i = 1; i <= n; i++)
        cin >> a[i];
    
    memset(res, 0x3f, sizeof res);
    
    // é•¿åº¦ä¸º 1 çš„æƒ…å†µ
    res[1] = 0;
    
    // é•¿åº¦ä¸º 2 çš„æƒ…å†µ
    for (int i = 1, j = i + 1; j <= n; i++, j++) {
        dp[i][j] = abs(a[i] - a[j]);
        res[2] = min(res[2], dp[i][j]);
    }
    
    // é•¿åº¦ >= 3 çš„æƒ…å†µ 
    for (int len = 3; len <= n; len++) {
        for (int i = 1, j = i + len - 1; j <= n; i++, j++) {
            dp[i][j] = dp[i + 1][j - 1] + abs(a[i] - a[j]);
            res[len] = min(res[len], dp[i][j]);
        }
    }
    
    for (int i = 1; i <= n; i++)
        cout << res[i] << ' ';
    
    return 0;
}
```

### çŠ¶å‹ dp

Avoid K Palindrome

<https://atcoder.jp/contests/abc359/tasks/abc359_d>

> é¢˜æ„ï¼šç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $n\le 1000$ çš„å­—ç¬¦ä¸² $s$ å’Œä¸€ä¸ªæ•´æ•° $k\le10$ï¼Œå…¶ä¸­å«æœ‰è‹¥å¹²ä¸ª `'A'`, `'B'` å’Œ `'?'`ã€‚å…¶ä¸­ `'?'` å¯ä»¥è½¬åŒ–ä¸º `'A'` æˆ– `'B'`ï¼Œå‡è®¾æœ‰ $q$ å’Œ `'?'`ï¼Œåˆ™ä¸€å…±å¯ä»¥è½¬åŒ–å‡º $2^q$ ä¸ªä¸åŒçš„ $s$ã€‚é—®æ‰€æœ‰è½¬åŒ–å‡ºçš„ $s$ ä¸­ï¼Œæœ‰å¤šå°‘æ˜¯ä¸å«æœ‰é•¿åº¦ä¸º $k$ çš„å›æ–‡å­ä¸²çš„ã€‚
>
> æ€è·¯ï¼šæœ€æš´åŠ›çš„åšæ³•å°±æ˜¯ 2^q æšä¸¾æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦ä¸²ï¼Œç„¶åå† O(n) çš„æ£€æŸ¥ï¼Œè¿™æ ·æ—¶é—´å¤æ‚åº¦ä¸º $O(n2^n)$ï¼Œåªèƒ½é€šè¿‡ 20 ä»¥å†…çš„æ•°æ®ã€‚ä¸€èˆ¬å­—ç¬¦ä¸²å›æ–‡é—®é¢˜å¯ä»¥è€ƒè™‘ dpã€‚

åƒå¥¶é…ª

<https://www.luogu.com.cn/problem/P1433>

> é¢˜æ„ï¼šç»™å®šä¸€ä¸ªå¹³é¢ç›´è§’åæ ‡ç³»ä¸ n ä¸ªç‚¹çš„åæ ‡ï¼Œèµ·ç‚¹åœ¨åæ ‡åŸç‚¹ã€‚é—®å¦‚ä½•é€‰æ‹©è¡Œè¿›è·¯çº¿ä½¿å¾—åˆ°è¾¾æ¯ä¸€ä¸ªç‚¹ä¸”æ€»è·¯ç¨‹æœ€çŸ­ 
> - æ€è·¯ä¸€ï¼šçˆ†æœã€‚é¢˜ä¸­çš„ $n \le 15$ ç›´æ¥æ— è„‘çˆ†æœï¼Œä½†æ˜¯ **TLE**ã€‚çˆ†æœçš„æ€è·¯ä¸ºï¼šæ¯æ¬¡é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œæ¥ä¸‹æ¥é€‰æ‹©å‰©ä½™çš„æ²¡æœ‰è¢«é€‰æ‹©è¿‡çš„ç‚¹ç»§ç»­æœç´¢ï¼ŒçŸ¥é“æ‰€æœ‰çš„ç‚¹å…¨éƒ¨éƒ½æœåˆ°ä¸ºæ­¢
>
>     æ—¶é—´å¤æ‚åº¦ï¼š$O(n!)$
>
> - æ€è·¯äºŒï¼šçŠ¶æ€å‹ç¼© DPã€‚
>
>     æ—¶é—´å¤æ‚åº¦ï¼š$O()$

çˆ†æœä»£ç 

```cpp
#include <bits/stdc++.h>
#define int long long
using namespace std;

const int N = 20;

int n;
double res = 4000.0;
bool vis[N];

struct Idx {
    double x, y;
} a[N];

double d(Idx be, Idx en) {
    return sqrt((be.x - en.x) * (be.x - en.x) + (be.y - en.y) * (be.y - en.y));
}

// çˆ¶ç»“ç‚¹åæ ‡ faï¼Œå½“å‰ç»“ç‚¹æ¬¡åº nowï¼Œå½“å‰è·¯å¾„é•¿åº¦ len 
void dfs(Idx fa, int now, double len) {
    vis[now] = true;
    
    if (count(vis + 1, vis + n + 1, true) == n) {
        res = min(res, len);
    }
    
    for (int i = 1; i <= n; i++)
        if (!vis[i])
            dfs(a[now], i, len + d(a[now], a[i]));
    
    vis[now] = false;
}

void solve() {
    cin >> n;
    for (int i = 1; i <= n; i++) {
        cin >> a[i].x >> a[i].y; 
    }
    
    for (int i = 1; i <= n; i++) {
        Idx fa = {0, 0};
        dfs(fa, i, d(fa, a[i]));
    }
    
    cout << fixed << setprecision(2) << res << "\n";
}

signed main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr), cout.tie(nullptr);
    int T = 1;
//    cin >> T;
    while (T--) solve();
    return 0;
}
```

çŠ¶å‹ dp ä»£ç 

```cpp

```
